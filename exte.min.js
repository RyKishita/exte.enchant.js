if(exte)throw Error('"exte" is used.');
var exte=function(){function t(a,b,c){a=Math.floor(a);if(0==a)return b[0];for(var e=[];0<a;){e.push(a%10);if(c.length+1<e.length){e.length=c.length;for(a=0;a<c.length;a++)e[a]=9;break}a=Math.floor(a/10)}for(a="";;){var f=e.pop();if(0!=f&&(1!=f||4==e.length||0==e.length))a+=b[f];if(0==e.length)break;0!=f&&(a+=c[e.length-1])}return a}var w=enchant.Class.create(enchant.Node,{initialize:function(a,b,c){enchant.Node.call(this);this._sound=enchant.Game.instance.assets[a];this._fadeSec=b||5;this._volume=
c||1;this.addEventListener(enchant.Event.ENTER_FRAME,function(){this._fadeSec<this._sound.duration-this._sound.currentTime||(this._sound.volume=(this._sound.duration-this._sound.currentTime)/this._fadeSec,0.01>this._sound.volume&&(this._sound.currentTime=0,this.play()))})},play:function(){this._sound.volume=this._volume;this._sound.play()},pause:function(){this._sound.pause()},stop:function(){this._sound.stop()}}),x=enchant.Class.create({initialize:function(a){this._table=[];this.range=a},next:{get:function(){for(var a=
[],b=0;b<this.range;b++)0==this.rand(this._table[b])&&a.push(b);a=0==a.length?this.rand(this.range):a[this.rand(a.length)];for(b=0;b<this.range;b++)this._table[b]--,b==a&&(this._table[b]+=this.range);return a}},range:{get:function(){return this._table.length},set:function(a){a<this.range&&(this._table.length=0);for(var b=this.range;b<a;b++)this._table.push(a)}},rand:function(a){return 0>=a?0:Math.floor(Math.random()*a)}}),u="Event_SceneExInput",y=enchant.Class.create(enchant.Scene,function(){var a=
[];return{initialize:function(b,c,e){function f(a){var b=new enchant.Event(u);b.eventID=a.eventID;b.sec=a.frame/enchant.Game.instance.fps;enchant.Game.instance.currentScene.dispatchEvent(b)}enchant.Scene.call(this);this.name=b;a[b]=this;this.inputPatterns=[];this._opacity=1;this._setFadeOut=this._setFadeIn=!1;this._nextSceneName="";b=enchant.Game.instance.fps;c=void 0==c?0.5:c;0<c?(this._fadeInStep=1/(c*b),this.addEventListener(enchant.Event.ENTER,function(){this._setFadeIn=!0;this.opacity=0})):this.addEventListener(enchant.Event.ENTER,
function(){this._setFadeIn=!1;this.opacity=1});c=void 0==e?0.5:e;this._fadeOutStep=0==c?1:1/(c*b);this.addEventListener(enchant.Event.ENTER_FRAME,function(){if(this._setFadeIn&&this._fadeIn())this._setFadeIn=false;if(this._setFadeOut&&this._fadeOut()){this._setFadeOut=false;var b=a[this._nextSceneName];b.dispatchEvent(new enchant.Event("Event_SceneExStarting"));b==this?b.dispatchEvent(new enchant.Event(enchant.Event.ENTER)):enchant.Game.instance.replaceScene(b)}for(var c in this.inputPatterns){b=
this.inputPatterns[c];b.active&&b.frame++}});[enchant.Event.LEFT_BUTTON_DOWN,enchant.Event.LEFT_BUTTON_UP,enchant.Event.RIGHT_BUTTON_DOWN,enchant.Event.RIGHT_BUTTON_UP,enchant.Event.UP_BUTTON_DOWN,enchant.Event.UP_BUTTON_UP,enchant.Event.DOWN_BUTTON_DOWN,enchant.Event.DOWN_BUTTON_UP,enchant.Event.A_BUTTON_DOWN,enchant.Event.A_BUTTON_UP,enchant.Event.B_BUTTON_DOWN,enchant.Event.B_BUTTON_UP].forEach(function(a){this.addEventListener(a,function(a){for(var b in this.inputPatterns){var c=this.inputPatterns[b];
if(c.pattern[c.index]!=a.type){c.index=0;c.frame=0;c.active=false}else if(c.index+1<c.pattern.length){c.index++;c.active=true}else if(c.loop){c.active=true;if(!(c.frame<c.framelimit)){f(c);c.frame=0}}else{c.frame<=c.framelimit&&f(c);c.index=0;c.frame=0;c.active=false}}})},this);this._fadeIn=function(){if(1-this._fadeInStep<=this.opacity){this.opacity=1;return true}this.opacity=this.opacity+this._fadeInStep;return false};this._fadeOut=function(){if(this.opacity<=this._fadeOutStep){this.opacity=0;return true}this.opacity=
this.opacity-this._fadeOutStep;return false};this._setOpacityChilds=function(a,b){if(a.childNodes!==void 0)for(var c in a.childNodes){var f=a.childNodes[c];if(f.opacity!==void 0)f.opacity=b;this._setOpacityChilds(f,b)}}},fadeProsessing:{get:function(){return this._setFadeIn||this._setFadeOut}},opacity:{get:function(){return this._opacity},set:function(a){this._opacity=a;this._setOpacityChilds(this,a)}},moveSceneTo:function(a){this._nextSceneName=a;this._setFadeOut=!0},registInputPattern:function(a,
c,e,f){this.inputPatterns.push({eventID:a,pattern:c,index:0,frame:0,framelimit:Math.floor((e||1)*enchant.Game.instance.fps),loop:!0==f,active:!1})}}}()),z=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);this._startFrame=this._frame=0;this._active=!1;this.addEventListener(enchant.Event.ENTER_FRAME,function(){this._active&&(this._frame--,0<this._frame||(enchant.Game.instance.currentScene.dispatchEvent(new enchant.Event("Event_TimerTimeout")),this._frame=this._startFrame))})},
start:function(a){"number"==typeof a&&(this._frame=this._startFrame=a*enchant.Game.instance.fps);this._active=0<this._startFrame},stop:function(){this._active=!1}}),r=function(a){return 0>a?this.normalinzeRad(a+2*Math.PI):2*Math.PI<=a?this.normalinzeRad(a-2*Math.PI):a},p=function(a,b){for(var c=[],e=0;e<b;e++)c.push(a);return c},A=enchant.Class.create({initialize:function(){this.point1=[46,127];this.point2=[46,147];this.point3=[31,127];this.point4=[31,147];this.todohuken="\u5317\u6d77\u9053 \u9752\u68ee\u770c \u5ca9\u624b\u770c \u5bae\u57ce\u770c \u79cb\u7530\u770c \u5c71\u5f62\u770c \u798f\u5cf6\u770c \u8328\u57ce\u770c \u6803\u6728\u770c \u7fa4\u99ac\u770c \u57fc\u7389\u770c \u5343\u8449\u770c \u6771\u4eac\u90fd \u795e\u5948\u5ddd\u770c \u65b0\u6f5f\u770c \u5bcc\u5c71\u770c \u77f3\u5ddd\u770c \u798f\u4e95\u770c \u5c71\u68a8\u770c \u9577\u91ce\u770c \u5c90\u961c\u770c \u9759\u5ca1\u770c \u611b\u77e5\u770c \u4e09\u91cd\u770c \u6ecb\u8cc0\u770c \u4eac\u90fd\u5e9c \u5927\u962a\u5e9c \u5175\u5eab\u770c \u5948\u826f\u770c \u548c\u6b4c\u5c71\u770c \u9ce5\u53d6\u770c \u5cf6\u6839\u770c \u5ca1\u5c71\u770c \u5e83\u5cf6\u770c \u5c71\u53e3\u770c \u5fb3\u5cf6\u770c \u9999\u5ddd\u770c \u611b\u5a9b\u770c \u9ad8\u77e5\u770c \u798f\u5ca1\u770c \u4f50\u8cc0\u770c \u9577\u5d0e\u770c \u718a\u672c\u770c \u5927\u5206\u770c \u5bae\u5d0e\u770c \u9e7f\u5150\u5cf6\u770c \u6c96\u7e04\u770c".split(" ")},
getCurrentPosition:function(a){window.navigator.geolocation.getCurrentPosition(function(b){a(b.coords.latitude,b.coords.longitude)})},getXFromLong:function(a){return 0==a?0:320*(a-this.point1[1])/(this.point4[1]-this.point1[1])},getYFromLat:function(a){return 0==a?0:320*(1-(a-this.point4[0])/(this.point1[0]-this.point4[0]))},getLongFromX:function(a){return 0==a?0:this.point1[1]+a*(this.point4[1]-this.point1[1])/320},getLatFromY:function(a){return 0==a?0:this.point1[0]-a*(this.point1[0]-this.point4[0])/
320},show_location:function(a){this.currentLatitude=a.coords.latitude;this.currentLongitude=a.coords.longitude},getDistance:function(a,b){var c=a.latitude*Math.PI/180,e=b.latitude*Math.PI/180,f=6378.137*(b.longitude*Math.PI/180-a.longitude*Math.PI/180)*Math.cos(c),c=6378.137*(e-c);return Math.sqrt(f*f+c*c)}}),v=function(a,b,c){if(0==a%2||0==b%2)throw Error("arguments error");var e=[];e.length=a;if(c)for(var f=0;f<a;f++)0==f||f==a-1?e[f]=p(1,b):(e[f]=p(0,b),e[f][0]=e[f][b-1]=1);else for(f=0;f<a;f++)e[f]=
p(0,b);for(var g=4,o=[1,0,-1,0],l=[0,1,0,-1],f=c?2:1;f<a;f+=2){for(var h=c?2:1;h<b;h+=2){e[f][h]=1;var k=Math.floor(Math.random()*g);e[f+l[k]][h+o[k]]=1}4==g&&(g=3)}return e},i=function(a,b,c,e,f,g,o,l,h,k,j,i,m){for(var g=g||f,o=o||f,l=l||f,h=h||f,k=k||f,j=j||f,i=i||f,m=m||f,q=[],d=0;d<c;d++){var n;0==d?(n=p(o,e),n[0]=g,n[e-1]=l):d+1<c?(n=p(f,e),n[0]=h,n[e-1]=k):(n=p(i,e),n[0]=j,n[e-1]=m);q.push(n)}b=new Map(b,b);b.image=enchant.Game.instance.assets[a];b.loadData(q);return b},B=enchant.Class.create(enchant.Group,
{initialize:function(a,b,c,e){enchant.Group.call(this);this.x=a;this.y=b;this.width=c;this.height=e;this.fadeOut=this.fadeIn=0.1;this.lineHeight=10;this.font=this.color=null;this._labels=[];this._texts=[];this._currentWork=0;this._fadeOutIndex=this._fadeInIndex=-1;this._scrollNum=0;this.addEventListener(enchant.Event.ENTER_FRAME,function(){switch(this._currentWork){case 0:if(0<this._texts.length){var a=this._texts.shift();this._fadeInIndex=null;for(var b=0;b<this._labels.length;b++)if(!this._labels[b].visible){this._fadeInIndex=
b;break}var c;this._fadeInIndex?(c=this._labels[this._fadeInIndex],c.text=a.text):(c=new enchant.Label(a.text),c.width=this.width,c.opacity=0,c.visible=!1,this.addChild(c),this._fadeInIndex=this._labels.length,this._labels.push(c));a.font&&(c.font=a.font);a.color&&(c.color=a.color);this._scrollNum=this.lineHeight;a=0;for(b in this._labels){var e=this._labels[b];e.visible&&(e=e.y+e.height+10,a<e&&(a=e,this._fadeOutIndex=b))}this._currentWork=this.height<a+c.height?1:2}break;case 1:b=this._labels[this._fadeOutIndex];
b.opacity<this.fadeOut?(b.opacity=0,b.visible=!1,this._currentWork=2):b.opacity-=this.fadeOut;break;case 2:if(0<this._scrollNum){for(b in this._labels)e=this._labels[b],e.visible&&(e.y+=1);this._scrollNum--}else this._currentWork=3,this._labels[this._fadeInIndex].visible=!0;break;case 3:b=this._labels[this._fadeInIndex],1-this.fadeIn<b.opacity?(b.opacity=1,this._currentWork=0):b.opacity+=this.fadeIn}})},addLog:function(a,b,c){this._texts.push({text:a,color:b||this.color,font:c||this.font})}}),C=function(){var a=
function(d,a,b,c){var e=new Surface(d,a),f=e.context;c?(f.fillStyle=b,f.fillRect(0,0,d,a)):(f.strokeStyle=b,f.strokeRect(0,0,d,a));return e},b=function(d,a,b){var c=new Surface(2*d,2*d),e=c.context,f=e.lineWidth;b?e.fillStyle=a:e.strokeStyle=a;e.beginPath();e.arc(d,d,d-f,0,2*Math.PI,!0);b?e.fill():e.stroke();return c},c=function(d,a,b,c){var e=new Surface(d,a),f=e.context;c?f.fillStyle=b:f.strokeStyle=b;var b=d/2,g=a/2,h=f.lineWidth;f.beginPath();var j=4*(Math.sqrt(2)-1)*b/3,k=4*(Math.sqrt(2)-1)*
g/3;f.moveTo(b,h);f.bezierCurveTo(b+j,h,d-h,g-k,d-h,g);f.bezierCurveTo(d-h,g+k,b+j,a-h,b,a-h);f.bezierCurveTo(b-j,a-h,h,g+k,h,g);f.bezierCurveTo(h,g-k,b-j,h,b,h);c?f.fill():f.stroke();return e},e=enchant.Class.create({initialize:function(d,a){this.x=d||0;this.y=a||0},getDistance:function(d){var a=d.x-this.x,d=d.y-this.y;return Math.sqrt(a*a+d*d)},clone:function(){return new e(this.x,this.y)}}),f=enchant.Class.create({initialize:function(d,a,b,c){this.posS=new e(d,a);this.posE=new e(b,c)},dx:{get:function(){return this.posE.x-
this.posS.x},set:function(d){this.posE.x=this.posS.x+d}},dy:{get:function(){return this.posE.y-this.posS.y},set:function(d){this.posE.y=this.posS.y+d}},length:{get:function(){return this.posS.getDistance(this.posE)},set:function(d){var a=this.Length;this.posE.x=this.posS.x+Math.floor(this.dx*d/a);this.posE.y=this.posS.y+Math.floor(this.dy*d/a)}},isCrossLine:function(d){var a=-this.dy,b=this.dx,c=this.length;0<c&&(c=1/c);var a=a*c,b=b*c,e=d.dx,c=d.dy,f=a*e+b*c;if(0==f)return!1;a=-(a*d.posS.x+b*d.posS.y+
-(this.posS.x*a+this.posS.y*b))/f;if(0>=a||1<a)return!1;b=d.posS.x+e*a;d=d.posS.y+c*a;return 0>(this.posS.x-b)*(this.posE.x-b)+(this.posS.y-d)*(this.posE.y-d)},createSurface:function(d,a){var b,c,e;this.posS.x<this.posE.x==this.posS.y<this.posE.y?(b=0,c=Math.abs(this.dx),e=Math.abs(this.dy)):(b=Math.abs(this.dy),c=Math.abs(this.dx),e=0);var f=new Surface(Math.abs(this.dx),Math.abs(this.dy)),g=f.context;g.strokeStyle=d;g.lineWidth=a||1;g.beginPath();g.moveTo(0,b);g.lineTo(c,e);g.stroke();return f},
createSprite:function(d,a){var b=this.createSurface(d,a),c=new Sprite(b.width,b.height);c.x=Math.min(this.posS.x,this.posE.x);c.y=Math.min(this.posS.y,this.posE.y);c.image=b;return c},clone:function(){return new f(this.posS.x,this.posS.y,this.posE.x,this.posE.y)}}),g=enchant.Class.create({initialize:function(d,a,b,c){this.x=d||0;this.y=a||0;this.width=b||0;this.height=c||0},top:{get:function(){return this.y},set:function(d){this.y=d}},bottom:{get:function(){return this.y+this.height},set:function(d){this.height=
Math.abs(d-this.y);d<this.y&&(this.y=d)}},left:{get:function(){return this.x},set:function(d){this.x=d}},right:{get:function(){return this.x+this.width},set:function(d){this.width=Math.abs(d-this.x);d<this.x&&(this.x=d)}},center:{get:function(){return new e(this.x+this.width/2,this.y+this.height/2)},set:function(d){this.x=d.x-this.width/2;this.y=d.y-this.height/2}},diagonal:{get:function(){return Math.sqrt(this.width*this.width+this.height*this.height)},set:function(d){var a=this.diagonal;0==a?(d*=
Math.sqrt(2),this.x-=Math.floor(0.5*d),this.y-=Math.floor(0.5*d),this.width=this.height=Math.floor(d)):this.scale(d/a)}},scale:function(d,a){"number"!=typeof a&&(a=d);var b=this.width*d,c=this.height*a;this.x+=Math.floor(0.5*(this.width-b));this.y+=Math.floor(0.5*(this.height-c));this.width=Math.floor(b);this.height=Math.floor(c)},updateFrom:function(d){this.x=d.x;this.y=d.y;this.height=d.height*d.scaleX;this.width=d.width},setTo:function(d,a){d.x=this.x;d.y=this.y;a?(d.scaleX=d.scaleY=1,d.height=
this.height,d.width=this.width):(d.scaleX=this.width/d.width,d.scaleY=this.height/d.height)},getPixels:function(d){var d=d.context.getImageData(this.left,this.top,this.width,this.height).data,a=[];a.length=this.height;for(var b=0;b<this.height;b++){a[b]=[];a[b].length=this.width;for(var c=0;c<this.width;c++){var e=4*(b*this.width+c);a[b][c]={r:d[e],g:d[e+1],b:d[e+2],a:d[e+3]}}}return a},clone:function(){return new g(this.x,this.y,this.width,this.height)}}),o=enchant.Class.create(g,{initialize:function(d,
a,b,c){g.call(this,d,a,b,c);this._calcWidth=function(d){return Math.floor(0.5*this.width*((d-1)%3))};this._calcHeight=function(d){return Math.floor(0.5*this.height*(2-Math.floor((d-1)/3)))}},hitTest:function(d){return this.x<d.x&&d.x<this.right&&this.y<d.y&&d.y<this.bottom},intersectRect:function(d){return this.x<d.right&&d.x<this.right&&this.y<d.bottom&&d.y<this.bottom},intersectLine:function(d){return this.hitTest(d.posS)||this.hitTest(d.posE)?!0:this.getSideLine(0).isCross(d)||this.getSideLine(1).isCross(d)||
this.getSideLine(2).isCross(d)||this.getSideLine(3).isCross(d)},getPos:function(d){return new e(this.x+this._calcWidth(d),this.y+this._calcHeight(d))},setPos:function(d,a){this.x=a.x-this._calcWidth(d);this.y=a.y-this._calcHeight(d)},adjustPos:function(d){d.x<this.left?d.x=this.left:this.right<d.x&&(d.x=this.right);d.y<this.top?d.y=this.top:this.bottom<d.y&&(d.y=this.bottom)},getRandomPos:function(){return new e(this.x+Math.floor(Math.random()*this.width),this.y+Math.floor(Math.random()*this.height))},
getSideLine:function(d){var a,b;switch(d){case 0:a=7;b=9;break;case 1:a=1;b=3;break;case 2:a=7;b=1;break;case 3:a=9,b=3}d=new f;d.posS=this.getPos(a);d.posE=this.getPos(b);return d},getDiagonalLine:function(d){var a;switch(d){case 1:a=9;break;case 3:a=7;break;case 7:a=3;break;case 9:a=1}var b=new f;b.posS=this.getPos(d);b.posE=this.getPos(a);return b},createSurface:function(d,b){return a(this.width,this.height,d,b)},createSprite:function(d,a){var b=this.createSurface(d,a),c=new Sprite(b.width,b.height);
c.image=b;c.x=this.x;c.y=this.y;return c},clone:function(){return new o(this.x,this.y,this.width,this.height)}}),i=enchant.Class.create(g,{initialize:function(d,a,b){g.call(this,d-b,a-b,2*b,2*b)},radius:{get:function(){return this.width/2},set:function(d){var a=Math.floor(0.5*(d-this.radius));this.x-=a;this.y-=a;this.width=2*d}},diameter:{get:function(){return this.width},set:function(d){var a=Math.floor(0.5*(d-this.diameter));this.x-=a;this.y-=a;this.width=d}},hitTest:function(d){return this.center.getDistance("Point"==
typeof sec?d:new e(d.x,d.y))<this.radius},intersectRect:function(){throw Error("Circle.intersectRect is not implemented");},intersectLine:function(){throw Error("Circle.intersectLine is not implemented");},intersectCircle:function(d){var a=(this.diameter+d.diameter)/2,b;return(b=this.x-rect.x+(this.width-rect.width)/2)*b+(b=this.y-d.y+(this.height-d.height)/2)*b<a*a},adjustPos:function(d){var a=this.center.getDistance(d);if(!(a<this.radius)){var b=this.center;d.x=b.x+Math.floor(this.radius*(d.x-b.x)/
a);d.y=b.y+Math.floor(this.radius*(d.y-b.y)/a)}},getRandomPos:function(){var d=Math.random()*this.radius,a=2*Math.random()*Math.PI,b=this.center;b.x+=Math.floor(Math.cos(a)*d);b.y+=Math.floor(Math.sin(a)*d);return b},createSurface:function(d,a){return b(this.radius,d,a)},createSprite:function(d,a){var b=this.createSurface(d,a),c=new Sprite(b.width,b.height);c.image=b;c.x=this.x;c.y=this.y;return c},clone:function(){var d=this.center;return new i(d.x,d.y,this.radius)}}),h=enchant.Class.create(g,{initialize:function(d,
a,b,c){g.call(this,d-b/2,a-c/2,b,c)},hitTest:function(){throw Error("Ellipse.hitTest is not implemented");},intersectRect:function(){throw Error("Ellipse.intersectRect is not implemented");},intersectLine:function(){throw Error("Ellipse.intersectLine is not implemented");},adjustPos:function(){throw Error("Ellipse.adjustPos is not implemented");},getRandomPos:function(){throw Error("Ellipse.getRandomPos is not implemented");},createSurface:function(d,a){return c(this.width,this.height,d,a)},createSprite:function(d,
a){var b=this.createSurface(d,a),c=new Sprite(b.width,b.height);c.image=b;c.x=this.x;c.y=this.y;return c},clone:function(){var d=this.center;return new h(d.x,d.y,this.width,this.height)}}),k=enchant.Class.create(i,{initialize:function(d,a,b,c,e){i.call(this,d,a,b);this.angle=r(c|0);this.range=r(e|0)},angleStart:{get:function(){return r(this.angle-0.5*this.range)}},angleEnd:{get:function(){return r(this.angle+0.5*this.range)}},hitTest:function(){throw Error("Arc.hitTest is not implemented");},intersectRect:function(){throw Error("Arc.intersectRect is not implemented");
},intersectLine:function(){throw Error("Arc.intersectLine is not implemented");},intersectCircle:function(){throw Error("Arc.intersectCircle is not implemented");},adjustPos:function(){throw Error("Arc.adjustPos is not implemented");},getRandomPos:function(){var d=Math.random()*this.radius,a=this.angle+Math.random()*this.range-0.5*this.range,b=this.center;b.x+=Math.floor(Math.cos(a)*d);b.y+=Math.floor(Math.sin(a)*d);return b},createSurface:function(d,a){var b=this.radius,c=this.angle,e=this.range,
f=new Surface(2*b,2*b),g=f.context,h=g.lineWidth,j=c-0.5*e,c=c+0.5*e;a?g.fillStyle=d:g.strokeStyle=d;g.beginPath();g.moveTo(b,b);g.arc(b,b,b-h,j,c,!1);g.lineTo(b,b);a?g.fill():g.stroke();return f},createSprite:function(d,a){var b=this.createSurface(d,a),c=new Sprite(b.width,b.height);c.image=b;c.x=this.x;c.y=this.y;return c},clone:function(){var d=this.center;return new k(d.x,d.y,this.radius,this.angle,this.range)}});enchant.Class.create({initialize:function(d,a){this.set(d,a)},set:function(d,a){this.x=
d;this.y=a},add:function(d){this.x+=d.x;this.y+=d.y;return this},sub:function(d){this.x-=d.x;this.y-=d.y;return this},scale:function(d){this.x*=d;this.y*=d;return this},div:function(d){d&&(this.x/=d,this.y/=d);return this},inner_product:function(d){return this.x*d.x+this.y*d.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},resize:function(d){this.length()&&this.scale(d/this.length());return this},normalize:function(){return this.resize(1)},angle:function(){return 180*Math.atan2(this.y,
this.x)/Math.PI},rotate:function(d){var d=d*Math.PI/180,a=this.length();this.x=Math.sin(d)*this.y+Math.cos(d)*this.x;this.y=Math.cos(d)*this.y-Math.sin(d)*this.x;this.resize(a);return this},clone:function(){return new j(this.x,this.y)},reverse:function(){this.x*=-1;this.y*=-1}});var j=enchant.Class.create({initialize:function(d,a,b,c){this.z=this.y=this.x=0;this.w=1;1<arguments.length&&(this.x=d,this.y=a,this.z=b,3<arguments.length&&(this.w=c));1==arguments.length&&(this.x=d.x,this.y=d.y,this.z=d.z,
this.w=d.w)},distance:function(){var d=Math.pow(this.x,2),a=Math.pow(this.y,2),b=Math.pow(this.z,2);return Math.sqrt(d+a+b)},normalize:function(){this.distance();this.x/=len;this.y/=len;this.z/=len},dotProduct:function(d){return this.x*d.x+this.y*d.y+this.z*d.z},add:function(d){this.x+=d.x;this.y+=d.y;this.z+=d.z;this.w+=d.w},sub:function(d){this.x-=d.x;this.y-=d.y;this.z-=d.z;this.w-=d.w},scale:function(d){this.x*=d;this.y*=d;this.z*=d;this.w*=d},copy:function(){return new j(this.x,this.y,this.z,
this.w)},toString:function(){return"("+this.x+","+this.y+","+this.z+","+this.w+")"}}),s=enchant.Class.create({initialize:function(d){this.matrix=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];this.tmpMat=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];if(1==arguments.length)if(void 0!=d.matrix)for(var a=0;4>a;a++)for(var b=0;4>b;b++)this.matrix[a][b]=d.matrix[a][b];else this.matrix=d},apply:function(d){var a=this.matrix;return new j(a[0][0]*d.x+a[0][1]*d.y+a[0][2]*d.z+a[0][3]*d.w,a[1][0]*d.x+a[1][1]*d.y+a[1][2]*
d.z+a[1][3]*d.w,a[2][0]*d.x+a[2][1]*d.y+a[2][2]*d.z+a[2][3]*d.w,a[3][0]*d.x+a[3][1]*d.y+a[3][2]*d.z+a[3][3]*d.w)},composition:function(d){for(var a=this.matrix,b=[],c=0;4>c;c++){b[c]=[];for(var e=0;4>e;e++)for(var f=b[c][e]=0;4>f;f++)b[c][e]+=a[c][f]*d.matrix[f][e]}return new s(b)},compositionMe:function(a){for(var b=this.matrix,c=0;4>c;c++)for(var e=0;4>e;e++){for(var f=0,g=0;4>g;g++)f+=b[g][e]*a.matrix[c][g];this.tmpMat[c][e]=f}for(c=0;4>c;c++)for(e=0;4>e;e++)this.matrix[c][e]=this.tmpMat[c][e]},
rotateX:function(a){var b=Math.cos(a),a=Math.sin(a);this.matrix=[[1,0,0,0],[0,b,-a,0],[0,a,b,0],[0,0,0,1]]},rotateY:function(a){var b=Math.cos(a),a=Math.sin(a);this.matrix=[[b,0,a,0],[0,1,0,0],[-a,0,b,0],[0,0,0,1]]},rotateZ:function(a){var b=Math.cos(a),a=Math.sin(a);this.matrix=[[b,-a,0,0],[a,b,0,0],[0,0,1,0],[0,0,0,1]]},rotateWithVector:function(a,b){var c=Math.cos(a),e=1-c,f=Math.sin(a),g=b.x,h=b.y,j=b.z;this.matrix=[[g*g*e+c,g*h*e-j*f,j*g*e+h*f,0],[g*h*e+j*f,h*h*e+c,h*j*e+g*f,0],[j*g*e-h*f,h*
j*e+g*f,j*j*e+c,0],[0,0,0,1]]},toString:function(){for(var a=this.matrix,b="",c=0;4>c;c++){for(var b=b+"|",e=0;4>e;e++)b+=" "+a[c][e]+" ";b+="|\n"}return b},print:function(){alert(this.toString())}}),m=enchant.Class.create(Array,{initialize:function(a){Array.call(this);if(void 0!=a)for(var b=0;b<a.length;b++)this.push(new j(a[b]))},apply:function(a){for(var b=new m,c=0;c<this.length;c++)b.push(a.apply(this[c]));return b},applyFast:function(a,b){for(var c=0;c<this.length;c++)this[c].x=b.matrix[0][0]*
a[c].x+b.matrix[0][1]*a[c].y+b.matrix[0][2]*a[c].z+b.matrix[0][3]*a[c].w,this[c].y=b.matrix[1][0]*a[c].x+b.matrix[1][1]*a[c].y+b.matrix[1][2]*a[c].z+b.matrix[1][3]*a[c].w,this[c].z=b.matrix[2][0]*a[c].x+b.matrix[2][1]*a[c].y+b.matrix[2][2]*a[c].z+b.matrix[2][3]*a[c].w,this[c].w=b.matrix[3][0]*a[c].x+b.matrix[3][1]*a[c].y+b.matrix[3][2]*a[c].z+b.matrix[3][3]*a[c].w;return this},scale:function(a){for(var b=new m,c=0;c<this.length;c++)b.push(a*this[c]);return b},toString:function(){for(var a="",b=0;b<
this.length;b++)a+=this[b]+",";return a}}),q=enchant.Class.create(enchant.EventTarget,{initialize:function(a,b,c){enchant.EventTarget.call(this);this.dv=1==arguments.length?a:0==arguments.length?new j(0,0,0):new j(a,b,c);this.up=new j(0,1,0);this.r=new j(1,0,0);this.u=new j(0,1,0);this.f=new j(0,0,1);this.rotMat=new s;this.movMat=new s;this.rm=new s},rotateY:function(a){this.rm.rotateY(a);this.r=this.rm.apply(this.r);this.u=this.rm.apply(this.u);this.f=this.rm.apply(this.f)},moveR:function(a){this.dv.x+=
a*this.r.x;this.dv.y+=a*this.r.y;this.dv.z+=a*this.r.z},moveU:function(a){this.dv.x+=a*this.u.x;this.dv.y+=a*this.u.y;this.dv.z+=a*this.u.z},moveF:function(a){this.dv.x+=a*this.f.x;this.dv.y+=a*this.f.y;this.dv.z+=a*this.f.z},movePosition:function(a,b,c){1==arguments.length?(this.dv.x+=a.x,this.dv.y+=a.y,this.dv.z+=a.z):(this.dv.x+=a,this.dv.y+=b,this.dv.z+=c)},setPosition:function(a,b,c){1==arguments.length?(this.dv.x=a.x,this.dv.y=a.y,this.dv.z=a.z):(this.dv.x=a,this.dv.y=b,this.dv.z=c)},setAttitude:function(a,
b,c){this.r.x=a.x;this.r.y=a.y;this.r.z=a.z;this.u.x=b.x;this.u.y=b.y;this.u.z=b.z;this.f.x=c.x;this.f.y=c.y;this.f.z=c.z},updateMat:function(){this.movMat.initialize();this.movMat.matrix[0][3]=this.dv.x;this.movMat.matrix[1][3]=this.dv.y;this.movMat.matrix[2][3]=this.dv.z;this.rotMat.initialize();this.rotMat.matrix[0][0]=this.r.x;this.rotMat.matrix[0][1]=this.u.x;this.rotMat.matrix[0][2]=this.f.x;this.rotMat.matrix[1][0]=this.r.y;this.rotMat.matrix[1][1]=this.u.y;this.rotMat.matrix[1][2]=this.f.y;
this.rotMat.matrix[2][0]=this.r.z;this.rotMat.matrix[2][1]=this.u.z;this.rotMat.matrix[2][2]=this.f.z},toString:function(){return"dv: "+this.dv.toString()+", f: "+this.f.toString()}});enchant.Class.create(q,{initialize:function(a,b,c){q.call(this,a,b,c);this.color="#000000";this.sphereR=0;this.sphereOrigin=new j;this.vt=new m;this.rvt=new m;this.updateMat()},setVT:function(a){this.vt=new m(a);this.rvt=new m(a)},draw:function(a,b,c){var e=this.rvt;this.updateMat();this.rm=this.movMat.composition(this.rotMat);
this.rm.compositionMe(b);this.rm.compositionMe(c);e.applyFast(this.vt,this.rm);a.beginPath();a.strokeStyle=this.color;a.lineWidth=1;0<=e[0].w&&a.moveTo(Math.round(e[0].x/e[0].w),Math.round(e[0].y/e[0].w));b=1;for(c=e.length;b<c;b++)0<=e[b].w&&a.lineTo(Math.round(e[b].x/e[b].w),Math.round(e[b].y/e[b].w));a.stroke()},shapeSphereHit:function(a){var b=this.dv,c=this.sphereOrigin,e=new j(b.x+c.x,b.y+c.y,b.z+c.z),b=a.dv,c=a.sphereOrigin,b=new j(b.x+c.x,b.y+c.y,b.z+c.z);e.sub(b);return e.distance()<=a.sphereR+
this.sphereR?!0:!1}});enchant.Class.create(q,{initialize:function(a,b,c){q.call(this,a,b,c);this.sphereR=0;this.sphereOrigin=new j;this.front=new j(0,0,-1);this.cv=new j;this.updateMat()},updateMat:function(){this.front=this.f.copy();this.front.scale(-1);this.cv.x=this.dv.dotProduct(this.r);this.cv.y=this.dv.dotProduct(this.u);this.cv.z=this.dv.dotProduct(this.front);this.rotMat.matrix[0][3]=-this.cv.x;this.rotMat.matrix[1][3]=-this.cv.y;this.rotMat.matrix[2][3]=-this.cv.z;this.rotMat.matrix[0][0]=
this.r.x;this.rotMat.matrix[0][1]=this.r.y;this.rotMat.matrix[0][2]=this.r.z;this.rotMat.matrix[1][0]=this.u.x;this.rotMat.matrix[1][1]=this.u.y;this.rotMat.matrix[1][2]=this.u.z;this.rotMat.matrix[2][0]=this.front.x;this.rotMat.matrix[2][1]=this.front.y;this.rotMat.matrix[2][2]=this.front.z}});return{createRectangleSurface:a,createRectangleSprite:function(b,c,e,f){var g=new Sprite(b,c);g.image=a(b,c,e,f);return g},createCircleSurface:b,createCircleSprite:function(a,c,e){var f=new Sprite(2*a,2*a);
f.image=b(a,c,e);return f},createEllipseSurface:c,createEllipseSprite:function(a,b,e,f){var g=new Sprite(a,b);g.image=c(a,b,e,f);return g},Point:e,Line:f,Area:g,Rectangle:o,Circle:i,Ellipse:h,Arc:k}}();return{trace:function(){if(0!=arguments.length){var a=Array.prototype.slice.call(arguments,0),b;for(b in a)console.log(a[b])}},makeSpace:function(a){var b="&nbsp;";if(a)for(var c=1;c<a;c++)b+="&nbsp;";return b},playSound:function(a){enchant.Game.instance.assets[a].clone().play()},RepeatSoundPlayer:w,
AverageRandamizer:x,Event_SceneExStarting:"Event_SceneExStarting",Event_SceneExInput:u,SceneEx:y,addFadeOutText:function(a,b,c,e){void 0!=MutableText&&(b=new MutableText(b.x,b.y),b.text=c.toString(),b.fedingValue=1/(enchant.Game.instance.fps*(e||1)),b.addEventListener(enchant.Event.ENTER_FRAME,function(){this.opacity-=this.fedingValue;this.opacity<this.fedingValue&&this.parentNode.removeChild(this)}),a.addChild(b))},keyBind:function(a,b){var c=enchant.Game.instance;c.keybind(a[0].toUpperCase().charCodeAt(0),
b);c.keybind(a[0].toLowerCase().charCodeAt(0),b)},toRGBString:function(){if(0==arguments.length)throw Error("toRGBString: invalid arguments.");var a,b,c,e=1;3<=arguments.length?(a=arguments[0],b=arguments[1],c=arguments[2],4<=arguments.length&&(e=arguments[3])):(a=b=c=arguments[0],2<=arguments.length&&(e=arguments[1]));return"rgba("+a+","+b+","+c+","+e+")"},shuffleArray:function(a){for(var b=[];0<a.length;){var c=Math.floor(Math.random()*a.length);b.push(a.splice(c,1)[0])}return b},Event_TimerTimeOut:"Event_TimerTimeout",
Timer:z,toKanji1:function(a){return t(a,"\u3007\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d","\u5341\u767e\u5343\u4e07")},toKanji2:function(a){return t(a,"\u96f6\u58f1\u5f10\u53c2\u8086\u4f0d\u9678\u6f06\u634c\u7396","\u62fe\u4f70\u9621\u842c")},degToRad:function(a){return a*Math.PI/180},radToDeg:function(a){return 180*a/Math.PI},normalinzeRad:r,normalinzeDeg:function(a){return 0>a?this.normalinzeDeg(a+360):360<=a?this.normalinzeDeg(a-360):a},makeValues:p,Geolocation:A,collision2Sprites:function(a,
b){if(0==a.rotation&&0==b.rotation)return a.intersect(b);var c=Array(9),e=Array(9);c[0]={X:a.x,Y:a.y};c[1]={X:a.x+a.width,Y:a.y};c[2]={X:a.x+a.width,Y:a.y+a.height};c[3]={X:a.x,Y:a.y+a.height};c[4]={X:a.x,Y:a.y};c[5]={X:a.x+a.width/2,Y:a.y};c[6]={X:a.x+a.width/2,Y:a.y+a.height};c[7]={X:a.x,Y:a.y+a.height/2};c[8]={X:a.x+a.width,Y:a.y+a.height/2};e[0]={X:b.x,Y:b.y};e[1]={X:b.x+b.width,Y:b.y};e[2]={X:b.x+b.width,Y:b.y+b.height};e[3]={X:b.x,Y:b.y+b.height};e[4]={X:b.x,Y:b.y};e[5]={X:b.x+b.width/2,Y:b.y};
e[6]={X:b.x+b.width/2,Y:b.y+b.height};e[7]={X:b.x,Y:b.y+b.height/2};e[8]={X:b.x+b.width,Y:b.y+b.height/2};for(var f in c)c[f].X-=a.x+a.width/2,c[f].Y-=a.y+a.height/2;for(f in e)e[f].X-=b.x+b.width/2,e[f].Y-=b.y+b.height/2;for(f in c){var g=c[f].X,i=c[f].Y;c[f].X=g*Math.cos(a.rotation*Math.PI/180)-i*Math.sin(a.rotation*Math.PI/180);c[f].Y=g*Math.sin(a.rotation*Math.PI/180)+i*Math.cos(a.rotation*Math.PI/180)}for(f in e)g=e[f].X,i=e[f].Y,e[f].X=g*Math.cos(b.rotation*Math.PI/180)-i*Math.sin(b.rotation*
Math.PI/180),e[f].Y=g*Math.sin(b.rotation*Math.PI/180)+i*Math.cos(b.rotation*Math.PI/180);for(f in c)c[f].X+=a.x+a.width/2,c[f].Y+=a.y+a.height/2;for(f in e)e[f].X+=b.x+b.width/2,e[f].Y+=b.y+b.height/2;for(f=0;f<c.length-1;f++)for(g=0;g<e.length-1;g++){var i=(e[g+1].X-e[g].X)*(c[f].Y-e[g].Y)-(e[g+1].Y-e[g].Y)*(c[f].X-e[g].X),l=(e[g+1].X-e[g].X)*(c[f+1].Y-e[g].Y)-(e[g+1].Y-e[g].Y)*(c[f+1].X-e[g].X);if(0>((c[f+1].X-c[f].X)*(e[g].Y-c[f].Y)-(c[f+1].Y-c[f].Y)*(e[g].X-c[f].X))*((c[f+1].X-c[f].X)*(e[g+1].Y-
c[f].Y)-(c[f+1].Y-c[f].Y)*(e[g+1].X-c[f].X))&&0>i*l)return!0}return!1},createMaze:v,setMazeData:function(a,b,c,e,f,g){for(var i=[],l=[],g=v(b,c,g),h=0;h<b;h++){i.push([]);l.push([]);for(var k=0;k<c;k++)i[h].push(e),l[h].push(g[h][k]?f:-1)}a.loadData(i,l);a.collisionData=g},stringWidth:function(a,b){return a.context.measureText(b).width},toKatakanaCase:function(a){for(var b="",c=0;c<a.length;c++)var e=a.charCodeAt(c),b=b+String.fromCharCode(12353<=e&&12438>=e?e+96:e);return b},toHirakanaCase:function(a){for(var b=
"",c=0;c<a.length;c++)var e=a.charCodeAt(c),b=b+String.fromCharCode(12449<=e&&12534>=e?e-96:e);return b},randomString:function(a){for(var b="",a=a||1,c=0;c<a;c++)b+="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz".charAt(Math.floor(49*Math.random()));return b},isOutOfScreen:function(a){var b=enchant.Game.instance;return 0>a.x+a.width||0>a.y+a.height||b.width<a.x||b.height<a.y},round:function(a,b){if("number"==typeof b){var c=Math.pow(10,b);return Math.round(a*c)/c}return Math.round(a)},ceil:function(a,
b){if("number"==typeof b){var c=Math.pow(10,b);return Math.ceil(a*c)/c}return Math.ceil(a)},floor:function(a,b){if("number"==typeof b){var c=Math.pow(10,b);return Math.floor(a*c)/c}return Math.floor(a)},paddingLeft:function(a,b,c){c=c||"0";a=a.toString();for(b-=a.length;0<b--;)a=c+a;return a},paddingRight:function(a,b,c){c=c||"0";a=a.toString();for(b-=a.length;0<b--;)a+=c;return a},formatString:function(a,b){var c=void 0;if("object"==typeof b)c=function(a,c){return b[c]};else var e=arguments,c=function(a,
b){return e[parseInt(b)+1]};return a.replace(/\{(\w+)\}/g,c)},arrayQueryIf:function(a,b){return a.filter(b)},arrayEraseIf:function(a,b){for(var c=a.length-1;0<=c;c--)b(a[c],c,a)&&a.splice(c,1)},samePartsForEach:function(a,b,c,e,f){function g(b,c){for(var g in k){var d=k[g];if(d.row==b&&d.column==c)return}g=a[b][c];(g=f?f(h,g):h==g)&&e(b,c);k.push({row:b,column:c,valid:g})}var i=a.length,l=a[0].length,h=a[b][c],k=[];for(g(b,c);;){var b=null,j;for(j in k)if(k[j].valid){b=k[j];break}if(null==b)break;
b.valid=!1;0<b.row&&g(b.row-1,b.column);0<b.column&&g(b.row,b.column-1);b.row+1<i&&g(b.row+1,b.column);b.column+1<l&&g(b.row,b.column+1)}},findWalkForEach:function(a,b,c,e,f){function g(b,c,e){var f=a[b][c];if(!(e<f)){var e=e-f,d;for(d in h)if(f=h[d],!(f.row!=b||f.column!=c)){f.rest<e&&(f.rest=e,f.valid=!0);return}h.push({row:b,column:c,rest:e,valid:!0})}}var i=a.length,l=a[0].length,h=[];h.push({row:b,column:c,rest:e,valid:!0});for(b=!0;;){var c=null,k;for(k in h)if(h[k].valid){c=h[k];break}if(null==
c)break;c.valid=!1;0<c.row&&g(c.row-1,c.column,c.rest);0<c.column&&g(c.row,c.column-1,c.rest);c.row+1<i&&g(c.row+1,c.column,c.rest);c.column+1<l&&g(c.row,c.column+1,c.rest);b&&(b=!1,c.rest=0)}for(k in h)c=h[k],f(c.row,c.column,c.rest)},createSimpleMap:i,createSampleMap:function(a,b,c){switch(a){case 0:return i("map1.gif",16,b,c,33);case 1:return i("map1.gif",16,b,c,36);case 2:return i("map1.gif",16,b,c,6);case 3:return i("map1.gif",16,b,c,7);case 4:return i("map1.gif",16,b,c,97);case 5:return i("map1.gif",
16,b,c,100);case 6:return i("map1.gif",16,b,c,161);case 7:return i("map1.gif",16,b,c,164);case 8:return i("map1.gif",16,b,c,225);case 9:return i("map1.gif",16,b,c,228);case 10:return i("map1.gif",16,b,c,33,16,17,18,32,34,48,49,50);case 11:return i("map1.gif",16,b,c,100,83,84,85,99,101,115,116,117);case 12:return i("map1.gif",16,b,c,161,144,145,146,160,162,176,177,178);case 13:return i("map1.gif",16,b,c,164,147,148,149,163,165,179,180,181);case 14:return i("map1.gif",16,b,c,228,211,212,213,227,229,
243,244,245)}return i("map1.gif",16,b,c,0)},logWindow:B,Figure:C}}();