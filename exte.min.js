// enchant.js拡張ライブラリ
// The MIT License
// Copyright (c) 2012 Ryuuma Kishita
if (exte) throw Error('"exte" is used.');
var exte=function(){function r(a,b,d){a=Math.floor(a);if(0==a)return b[0];for(var e=[];0<a;){e.push(a%10);if(d.length+1<e.length){e.length=d.length;for(a=0;a<d.length;a++)e[a]=9;break}a=Math.floor(a/10)}for(a="";;){var f=e.pop();if(0!=f&&(1!=f||4==e.length||0==e.length))a+=b[f];if(0==e.length)break;0!=f&&(a+=d[e.length-1])}return a}var u=enchant.Class.create(enchant.Node,{initialize:function(a,b,d){enchant.Node.call(this);this._sound=enchant.Game.instance.assets[a];this._fadeSec=b||5;this._volume=
d||1;this.addEventListener(enchant.Event.ENTER_FRAME,function(){this._fadeSec<this._sound.duration-this._sound.currentTime||(this._sound.volume=(this._sound.duration-this._sound.currentTime)/this._fadeSec,0.01>this._sound.volume&&(this._sound.currentTime=0,this.play()))})},play:function(){this._sound.volume=this._volume;this._sound.play()},pause:function(){this._sound.pause()},stop:function(){this._sound.stop()}}),v=enchant.Class.create({initialize:function(a){this._table=[];this.range=a},next:{get:function(){for(var a=
[],b=0;b<this.range;b++)0==this.rand(this._table[b])&&a.push(b);a=0==a.length?this.rand(this.range):a[this.rand(a.length)];for(b=0;b<this.range;b++)this._table[b]--,b==a&&(this._table[b]+=this.range);return a}},range:{get:function(){return this._table.length},set:function(a){a<this.range&&(this._table.length=0);for(var b=this.range;b<a;b++)this._table.push(a)}},rand:function(a){return 0>=a?0:Math.floor(Math.random()*a)}}),s="Event_SceneExInput",w=enchant.Class.create(enchant.Scene,function(){var a=
[];return{initialize:function(b,d,e){function f(a){var b=new enchant.Event(s);b.eventID=a.eventID;b.sec=a.frame/enchant.Game.instance.fps;enchant.Game.instance.currentScene.dispatchEvent(b)}enchant.Scene.call(this);this.name=b;a[b]=this;this.inputPatterns=[];this._opacity=1;this._setFadeOut=this._setFadeIn=!1;this._nextSceneName="";b=enchant.Game.instance.fps;d=void 0==d?0.5:d;0<d&&(this._fadeInStep=1/(d*b),this.addEventListener(enchant.Event.ENTER,function(){this._setFadeIn=!0;this.opacity=0}));
d=void 0==e?0.5:e;this._fadeOutStep=0==d?1:1/(d*b);this.addEventListener(enchant.Event.ENTER_FRAME,function(){if(this._setFadeIn&&this._fadeIn())this._setFadeIn=false;if(this._setFadeOut&&this._fadeOut()){this._setFadeOut=false;var b=a[this._nextSceneName];b.dispatchEvent(new enchant.Event("Event_SceneExStarting"));enchant.Game.instance.replaceScene(b)}for(var d in this.inputPatterns){b=this.inputPatterns[d];b.active&&b.frame++}});[enchant.Event.LEFT_BUTTON_DOWN,enchant.Event.LEFT_BUTTON_UP,enchant.Event.RIGHT_BUTTON_DOWN,
enchant.Event.RIGHT_BUTTON_UP,enchant.Event.UP_BUTTON_DOWN,enchant.Event.UP_BUTTON_UP,enchant.Event.DOWN_BUTTON_DOWN,enchant.Event.DOWN_BUTTON_UP,enchant.Event.A_BUTTON_DOWN,enchant.Event.A_BUTTON_UP,enchant.Event.B_BUTTON_DOWN,enchant.Event.B_BUTTON_UP].forEach(function(a){this.addEventListener(a,function(a){for(var b in this.inputPatterns){var d=this.inputPatterns[b];if(d.pattern[d.index]!=a.type){d.index=0;d.frame=0;d.active=false}else if(d.index+1<d.pattern.length){d.index++;d.active=true}else if(d.loop){d.active=
true;if(!(d.frame<d.framelimit)){f(d);d.frame=0}}else{d.frame<=d.framelimit&&f(d);d.index=0;d.frame=0;d.active=false}}})},this);this._fadeIn=function(){if(1-this._fadeInStep<=this.opacity){this.opacity=1;return true}this.opacity=this.opacity+this._fadeInStep;return false};this._fadeOut=function(){if(this.opacity<=this._fadeOutStep){this.opacity=0;return true}this.opacity=this.opacity-this._fadeOutStep;return false}},fadeProsessing:{get:function(){return this._setFadeIn||this._setFadeOut}},opacity:{get:function(){return this._opacity},
set:function(a){this._opacity=a;for(var d in this.childNodes){var e=this.childNodes[d];e.opacity&&(e.opacity=a);if(e.childNodes)for(var f in e.childNodes)e.childNodes[f].opacity=a}}},moveSceneTo:function(a){this._nextSceneName=a;this._setFadeOut=!0},registInputPattern:function(a,d,e,f){this.inputPatterns.push({eventID:a,pattern:d,index:0,frame:0,framelimit:Math.floor((e||1)*enchant.Game.instance.fps),loop:!0==f,active:!1})}}}()),x=enchant.Class.create(enchant.Node,{initialize:function(){enchant.Node.call(this);
this._startFrame=this._frame=0;this._active=!1;this.addEventListener(enchant.Event.ENTER_FRAME,function(){this._active&&(this._frame--,0<this._frame||(enchant.Game.instance.currentScene.dispatchEvent(new enchant.Event("Event_TimerTimeout")),this._frame=this._startFrame))})},start:function(a){"number"==typeof a&&(this._frame=this._startFrame=a*enchant.Game.instance.fps);this._active=0<this._startFrame},stop:function(){this._active=!1}}),o=function(a,b){for(var d=[],e=0;e<b;e++)d.push(a);return d},
y=enchant.Class.create({initialize:function(){this.point1=[46,127];this.point2=[46,147];this.point3=[31,127];this.point4=[31,147];this.todohuken="\u5317\u6d77\u9053,\u9752\u68ee\u770c,\u5ca9\u624b\u770c,\u5bae\u57ce\u770c,\u79cb\u7530\u770c,\u5c71\u5f62\u770c,\u798f\u5cf6\u770c,\u8328\u57ce\u770c,\u6803\u6728\u770c,\u7fa4\u99ac\u770c,\u57fc\u7389\u770c,\u5343\u8449\u770c,\u6771\u4eac\u90fd,\u795e\u5948\u5ddd\u770c,\u65b0\u6f5f\u770c,\u5bcc\u5c71\u770c,\u77f3\u5ddd\u770c,\u798f\u4e95\u770c,\u5c71\u68a8\u770c,\u9577\u91ce\u770c,\u5c90\u961c\u770c,\u9759\u5ca1\u770c,\u611b\u77e5\u770c,\u4e09\u91cd\u770c,\u6ecb\u8cc0\u770c,\u4eac\u90fd\u5e9c,\u5927\u962a\u5e9c,\u5175\u5eab\u770c,\u5948\u826f\u770c,\u548c\u6b4c\u5c71\u770c,\u9ce5\u53d6\u770c,\u5cf6\u6839\u770c,\u5ca1\u5c71\u770c,\u5e83\u5cf6\u770c,\u5c71\u53e3\u770c,\u5fb3\u5cf6\u770c,\u9999\u5ddd\u770c,\u611b\u5a9b\u770c,\u9ad8\u77e5\u770c,\u798f\u5ca1\u770c,\u4f50\u8cc0\u770c,\u9577\u5d0e\u770c,\u718a\u672c\u770c,\u5927\u5206\u770c,\u5bae\u5d0e\u770c,\u9e7f\u5150\u5cf6\u770c,\u6c96\u7e04\u770c".split(",")},
getCurrentPosition:function(a){window.navigator.geolocation.getCurrentPosition(function(b){a(b.coords.latitude,b.coords.longitude)})},getXFromLong:function(a){return 0==a?0:320*(a-this.point1[1])/(this.point4[1]-this.point1[1])},getYFromLat:function(a){return 0==a?0:320*(1-(a-this.point4[0])/(this.point1[0]-this.point4[0]))},getLongFromX:function(a){return 0==a?0:this.point1[1]+a*(this.point4[1]-this.point1[1])/320},getLatFromY:function(a){return 0==a?0:this.point1[0]-a*(this.point1[0]-this.point4[0])/
320},show_location:function(a){this.currentLatitude=a.coords.latitude;this.currentLongitude=a.coords.longitude},getDistance:function(a,b){var d=a.latitude*Math.PI/180,e=b.latitude*Math.PI/180,f=6378.137*(b.longitude*Math.PI/180-a.longitude*Math.PI/180)*Math.cos(d),d=6378.137*(e-d);return Math.sqrt(f*f+d*d)}}),t=function(a,b,d){if(0==a%2||0==b%2)throw Error("arguments error");var e=[];e.length=a;if(d)for(var f=0;f<a;f++)0==f||f==a-1?e[f]=o(1,b):(e[f]=o(0,b),e[f][0]=e[f][b-1]=1);else for(f=0;f<a;f++)e[f]=
o(0,b);for(var g=4,j=[1,0,-1,0],m=[0,1,0,-1],f=d?2:1;f<a;f+=2){for(var k=d?2:1;k<b;k+=2){e[f][k]=1;var l=Math.floor(Math.random()*g);e[f+m[l]][k+j[l]]=1}4==g&&(g=3)}return e},z=function(){var a=function(c,i,a,b){var d=new Surface(c,i),e=d.context;b?(e.fillStyle=a,e.fillRect(0,0,c,i)):(e.strokeStyle=a,e.strokeRect(0,0,c,i));return d},b=function(c,i,a){var b=new Surface(2*c,2*c),d=b.context,e=d.lineWidth;a?d.fillStyle=i:d.strokeStyle=i;d.beginPath();d.arc(c,c,c-e,0,2*Math.PI,!0);a?d.fill():d.stroke();
return b},d=function(c,i,a,b){var d=new Surface(c,i),e=d.context;b?e.fillStyle=a:e.strokeStyle=a;var a=c/2,f=i/2,g=e.lineWidth;e.beginPath();var h=4*(Math.sqrt(2)-1)*a/3,j=4*(Math.sqrt(2)-1)*f/3;e.moveTo(a,g);e.bezierCurveTo(a+h,g,c-g,f-j,c-g,f);e.bezierCurveTo(c-g,f+j,a+h,i-g,a,i-g);e.bezierCurveTo(a-h,i-g,g,f+j,g,f);e.bezierCurveTo(g,f-j,a-h,g,a,g);b?e.fill():e.stroke();return d},e=enchant.Class.create({initialize:function(c,i){this.x=c||0;this.y=i||0},getDistance:function(c){var i=c.x-this.x,c=
c.y-this.y;return Math.sqrt(i*i+c*c)},clone:function(){return new e(this.x,this.y)}}),f=enchant.Class.create({initialize:function(c,i,a,b){this.posS=new e(c,i);this.posE=new e(a,b)},dx:{get:function(){return this.posE.x-this.posS.x},set:function(c){this.posE.x=this.posS.x+c}},dy:{get:function(){return this.posE.y-this.posS.y},set:function(c){this.posE.y=this.posS.y+c}},length:{get:function(){return this.posS.getDistance(this.posE)},set:function(c){var i=this.Length;this.posE.x=this.posS.x+Math.floor(this.dx*
c/i);this.posE.y=this.posS.y+Math.floor(this.dy*c/i)}},isCrossLine:function(c){var i=-this.dy,a=this.dx,b=this.length;0<b&&(b=1/b);var i=i*b,a=a*b,d=c.dx,b=c.dy,e=i*d+a*b;if(0==e)return!1;i=-(i*c.posS.x+a*c.posS.y+-(this.posS.x*i+this.posS.y*a))/e;if(0>=i||1<i)return!1;a=c.posS.x+d*i;c=c.posS.y+b*i;return 0>(this.posS.x-a)*(this.posE.x-a)+(this.posS.y-c)*(this.posE.y-c)},createSurface:function(c,a){var b,d,e;this.posS.x<this.posE.x==this.posS.y<this.posE.y?(b=0,d=Math.abs(this.dx),e=Math.abs(this.dy)):
(b=Math.abs(this.dy),d=Math.abs(this.dx),e=0);var f=new Surface(Math.abs(this.dx),Math.abs(this.dy)),g=f.context;g.strokeStyle=c;g.lineWidth=a||1;g.beginPath();g.moveTo(0,b);g.lineTo(d,e);g.stroke();return f},createSprite:function(c,a){var b=this.createSurface(c,a),d=new Sprite(b.width,b.height);d.x=Math.min(this.posS.x,this.posE.x);d.y=Math.min(this.posS.y,this.posE.y);d.image=b;return d},clone:function(){return new f(this.posS.x,this.posS.y,this.posE.x,this.posE.y)}}),g=enchant.Class.create({initialize:function(c,
a,b,d){this.x=c||0;this.y=a||0;this.width=b||0;this.height=d||0},top:{get:function(){return this.y},set:function(c){this.y=c}},bottom:{get:function(){return this.y+this.height},set:function(c){this.height=Math.abs(c-this.y);c<this.y&&(this.y=c)}},left:{get:function(){return this.x},set:function(c){this.x=c}},right:{get:function(){return this.x+this.width},set:function(c){this.width=Math.abs(c-this.x);c<this.x&&(this.x=c)}},center:{get:function(){return new e(this.x+this.width/2,this.y+this.height/
2)},set:function(c){this.x=c.x-this.width/2;this.y=c.y-this.height/2}},diagonal:{get:function(){return Math.sqrt(this.width*this.width+this.height*this.height)},set:function(c){var a=this.diagonal;0==a?(c*=Math.sqrt(2),this.x-=Math.floor(0.5*c),this.y-=Math.floor(0.5*c),this.width=this.height=Math.floor(c)):this.scale(c/a)}},scale:function(c,a){"number"!=typeof a&&(a=c);var b=this.width*c,d=this.height*a;this.x+=Math.floor(0.5*(this.width-b));this.y+=Math.floor(0.5*(this.height-d));this.width=Math.floor(b);
this.height=Math.floor(d)},updateFrom:function(c){this.x=c.x;this.y=c.y;this.height=c.height*c.scaleX;this.width=c.width},setTo:function(c,a){c.x=this.x;c.y=this.y;a?(c.scaleX=c.scaleY=1,c.height=this.height,c.width=this.width):(c.scaleX=this.width/c.width,c.scaleY=this.height/c.height)},getPixels:function(c){var c=c.context.getImageData(this.left,this.top,this.width,this.height).data,a=[];a.length=this.height;for(var b=0;b<this.height;b++){a[b]=[];a[b].length=this.width;for(var d=0;d<this.width;d++){var e=
4*(b*this.width+d);a[b][d]={r:c[e],g:c[e+1],b:c[e+2],a:c[e+3]}}}return a},clone:function(){return new g(this.x,this.y,this.width,this.height)}}),j=enchant.Class.create(g,{initialize:function(c,a,b,d){g.call(this,c,a,b,d);this._calcWidth=function(c){return Math.floor(0.5*this.width*((c-1)%3))};this._calcHeight=function(c){return Math.floor(0.5*this.height*(2-Math.floor((c-1)/3)))}},hitTest:function(c){return this.x<c.x&&c.x<this.right&&this.y<c.y&&c.y<this.bottom},intersectRect:function(c){return this.x<
c.right&&c.x<this.right&&this.y<c.bottom&&c.y<this.bottom},intersectLine:function(c){return this.hitTest(c.posS)||this.hitTest(c.posE)?!0:this.getSideLine(0).isCross(c)||this.getSideLine(1).isCross(c)||this.getSideLine(2).isCross(c)||this.getSideLine(3).isCross(c)},getPos:function(c){return new e(this.x+this._calcWidth(c),this.y+this._calcHeight(c))},setPos:function(c,a){this.x=a.x-this._calcWidth(c);this.y=a.y-this._calcHeight(c)},adjustPos:function(c){c.x<this.left?c.x=this.left:this.right<c.x&&
(c.x=this.right);c.y<this.top?c.y=this.top:this.bottom<c.y&&(c.y=this.bottom)},getRandomPos:function(){return new e(this.x+Math.floor(Math.random()*this.width),this.y+Math.floor(Math.random()*this.height))},getSideLine:function(c){var a,b;switch(c){case 0:a=7;b=9;break;case 1:a=1;b=3;break;case 2:a=7;b=1;break;case 3:a=9,b=3}c=new f;c.posS=this.getPos(a);c.posE=this.getPos(b);return c},getDiagonalLine:function(c){var a;switch(c){case 1:a=9;break;case 3:a=7;break;case 7:a=3;break;case 9:a=1}var b=
new f;b.posS=this.getPos(c);b.posE=this.getPos(a);return b},createSurface:function(c,b){return a(this.width,this.height,c,b)},createSprite:function(c,a){var b=this.createSurface(c,a),d=new Sprite(b.width,b.height);d.image=b;d.x=this.x;d.y=this.y;return d},clone:function(){return new j(this.x,this.y,this.width,this.height)}}),m=enchant.Class.create(g,{initialize:function(c,a,b){g.call(this,c-b,a-b,2*b,2*b)},radius:{get:function(){return this.width/2},set:function(c){var a=Math.floor(0.5*(c-this.radius));
this.x-=a;this.y-=a;this.width=2*c}},diameter:{get:function(){return this.width},set:function(c){var a=Math.floor(0.5*(c-this.diameter));this.x-=a;this.y-=a;this.width=c}},hitTest:function(c){return this.center.getDistance("Point"==typeof sec?c:new e(c.x,c.y))<this.radius},intersectRect:function(){throw Error("Circle.intersectRect is not implemented");},intersectLine:function(){throw Error("Circle.intersectLine is not implemented");},intersectCircle:function(c){var a=(this.diameter+c.diameter)/2,
b;return(b=this.x-rect.x+(this.width-rect.width)/2)*b+(b=this.y-c.y+(this.height-c.height)/2)*b<a*a},adjustPos:function(c){var a=this.center.getDistance(c);if(!(a<this.radius)){var b=this.center;c.x=b.x+Math.floor(this.radius*(c.x-b.x)/a);c.y=b.y+Math.floor(this.radius*(c.y-b.y)/a)}},getRandomPos:function(){var c=Math.random()*this.radius,a=2*Math.random()*Math.PI,b=this.center;b.x+=Math.floor(Math.cos(a)*c);b.y+=Math.floor(Math.sin(a)*c);return b},createSurface:function(c,a){return b(this.radius,
c,a)},createSprite:function(c,a){var b=this.createSurface(c,a),d=new Sprite(b.width,b.height);d.image=b;d.x=this.x;d.y=this.y;return d},clone:function(){var c=this.center;return new m(c.x,c.y,this.radius)}}),k=enchant.Class.create(g,{initialize:function(c,a,b,d){g.call(this,c-b/2,a-d/2,b,d)},hitTest:function(){throw Error("Ellipse.hitTest is not implemented");},intersectRect:function(){throw Error("Ellipse.intersectRect is not implemented");},intersectLine:function(){throw Error("Ellipse.intersectLine is not implemented");
},adjustPos:function(){throw Error("Ellipse.adjustPos is not implemented");},getRandomPos:function(){throw Error("Ellipse.getRandomPos is not implemented");},createSurface:function(c,a){return d(this.width,this.height,c,a)},createSprite:function(c,a){var b=this.createSurface(c,a),d=new Sprite(b.width,b.height);d.image=b;d.x=this.x;d.y=this.y;return d},clone:function(){var c=this.center;return new k(c.x,c.y,this.width,this.height)}}),l=enchant.Class.create(m,{initialize:function(c,a,b,d,e){m.call(this,
c,a,b);this._normalAngle=function(c){return 0>c?this._normalAngle(c+2*Math.PI):2*Math.PI<c?this._normalAngle(c-2*Math.PI):c};this.angle=this._normalAngle(d|0);this.range=this._normalAngle(e|0)},angleStart:{get:function(){return this._normalAngle(this.angle-0.5*this.range)}},angleEnd:{get:function(){return this._normalAngle(this.angle+0.5*this.range)}},hitTest:function(){throw Error("Arc.hitTest is not implemented");},intersectRect:function(){throw Error("Arc.intersectRect is not implemented");},intersectLine:function(){throw Error("Arc.intersectLine is not implemented");
},intersectCircle:function(){throw Error("Arc.intersectCircle is not implemented");},adjustPos:function(){throw Error("Arc.adjustPos is not implemented");},getRandomPos:function(){var c=Math.random()*this.radius,a=this.angle+Math.random()*this.range-0.5*this.range,b=this.center;b.x+=Math.floor(Math.cos(a)*c);b.y+=Math.floor(Math.sin(a)*c);return b},createSurface:function(c,a){var b=this.radius,d=this.angle,e=this.range,f=new Surface(2*b,2*b),g=f.context,h=g.lineWidth,j=d-0.5*e,d=d+0.5*e;a?g.fillStyle=
c:g.strokeStyle=c;g.beginPath();g.moveTo(b,b);g.arc(b,b,b-h,j,d,!1);g.lineTo(b,b);a?g.fill():g.stroke();return f},createSprite:function(c,a){var b=this.createSurface(c,a),d=new Sprite(b.width,b.height);d.image=b;d.x=this.x;d.y=this.y;return d},clone:function(){var c=this.center;return new l(c.x,c.y,this.radius,this.angle,this.range)}});enchant.Class.create({initialize:function(c,a){this.set(c,a)},set:function(c,a){this.x=c;this.y=a},add:function(c){this.x+=c.x;this.y+=c.y;return this},sub:function(c){this.x-=
c.x;this.y-=c.y;return this},scale:function(c){this.x*=c;this.y*=c;return this},div:function(c){c&&(this.x/=c,this.y/=c);return this},inner_product:function(c){return this.x*c.x+this.y*c.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},resize:function(c){this.length()&&this.scale(c/this.length());return this},normalize:function(){return this.resize(1)},angle:function(){return 180*Math.atan2(this.y,this.x)/Math.PI},rotate:function(c){var c=c*Math.PI/180,a=this.length();this.x=Math.sin(c)*
this.y+Math.cos(c)*this.x;this.y=Math.cos(c)*this.y-Math.sin(c)*this.x;this.resize(a);return this},clone:function(){return new h(this.x,this.y)},reverse:function(){this.x*=-1;this.y*=-1}});var h=enchant.Class.create({initialize:function(c,a,b,d){this.z=this.y=this.x=0;this.w=1;1<arguments.length&&(this.x=c,this.y=a,this.z=b,3<arguments.length&&(this.w=d));1==arguments.length&&(this.x=c.x,this.y=c.y,this.z=c.z,this.w=c.w)},distance:function(){var c=Math.pow(this.x,2),a=Math.pow(this.y,2),b=Math.pow(this.z,
2);return Math.sqrt(c+a+b)},normalize:function(){this.distance();this.x/=len;this.y/=len;this.z/=len},dotProduct:function(c){return this.x*c.x+this.y*c.y+this.z*c.z},add:function(c){this.x+=c.x;this.y+=c.y;this.z+=c.z;this.w+=c.w},sub:function(c){this.x-=c.x;this.y-=c.y;this.z-=c.z;this.w-=c.w},scale:function(c){this.x*=c;this.y*=c;this.z*=c;this.w*=c},copy:function(){return new h(this.x,this.y,this.z,this.w)},toString:function(){return"("+this.x+","+this.y+","+this.z+","+this.w+")"}}),p=enchant.Class.create({initialize:function(c){this.matrix=
[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];this.tmpMat=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];if(1==arguments.length)if(void 0!=c.matrix)for(var a=0;4>a;a++)for(var b=0;4>b;b++)this.matrix[a][b]=c.matrix[a][b];else this.matrix=c},apply:function(c){var a=this.matrix;return new h(a[0][0]*c.x+a[0][1]*c.y+a[0][2]*c.z+a[0][3]*c.w,a[1][0]*c.x+a[1][1]*c.y+a[1][2]*c.z+a[1][3]*c.w,a[2][0]*c.x+a[2][1]*c.y+a[2][2]*c.z+a[2][3]*c.w,a[3][0]*c.x+a[3][1]*c.y+a[3][2]*c.z+a[3][3]*c.w)},composition:function(c){for(var a=
this.matrix,b=[],d=0;4>d;d++){b[d]=[];for(var e=0;4>e;e++)for(var f=b[d][e]=0;4>f;f++)b[d][e]+=a[d][f]*c.matrix[f][e]}return new p(b)},compositionMe:function(c){for(var a=this.matrix,b=0;4>b;b++)for(var d=0;4>d;d++){for(var e=0,f=0;4>f;f++)e+=a[f][d]*c.matrix[b][f];this.tmpMat[b][d]=e}for(b=0;4>b;b++)for(d=0;4>d;d++)this.matrix[b][d]=this.tmpMat[b][d]},rotateX:function(c){var a=Math.cos(c),c=Math.sin(c);this.matrix=[[1,0,0,0],[0,a,-c,0],[0,c,a,0],[0,0,0,1]]},rotateY:function(c){var a=Math.cos(c),
c=Math.sin(c);this.matrix=[[a,0,c,0],[0,1,0,0],[-c,0,a,0],[0,0,0,1]]},rotateZ:function(c){var a=Math.cos(c),c=Math.sin(c);this.matrix=[[a,-c,0,0],[c,a,0,0],[0,0,1,0],[0,0,0,1]]},rotateWithVector:function(c,a){var b=Math.cos(c),d=1-b,e=Math.sin(c),f=a.x,g=a.y,h=a.z;this.matrix=[[f*f*d+b,f*g*d-h*e,h*f*d+g*e,0],[f*g*d+h*e,g*g*d+b,g*h*d+f*e,0],[h*f*d-g*e,g*h*d+f*e,h*h*d+b,0],[0,0,0,1]]},toString:function(){for(var c=this.matrix,a="",b=0;4>b;b++){for(var a=a+"|",d=0;4>d;d++)a+=" "+c[b][d]+" ";a+="|\n"}return a},
print:function(){alert(this.toString())}}),n=enchant.Class.create(Array,{initialize:function(c){Array.call(this);if(void 0!=c)for(var a=0;a<c.length;a++)this.push(new h(c[a]))},apply:function(c){for(var a=new n,b=0;b<this.length;b++)a.push(c.apply(this[b]));return a},applyFast:function(c,a){for(var b=0;b<this.length;b++)this[b].x=a.matrix[0][0]*c[b].x+a.matrix[0][1]*c[b].y+a.matrix[0][2]*c[b].z+a.matrix[0][3]*c[b].w,this[b].y=a.matrix[1][0]*c[b].x+a.matrix[1][1]*c[b].y+a.matrix[1][2]*c[b].z+a.matrix[1][3]*
c[b].w,this[b].z=a.matrix[2][0]*c[b].x+a.matrix[2][1]*c[b].y+a.matrix[2][2]*c[b].z+a.matrix[2][3]*c[b].w,this[b].w=a.matrix[3][0]*c[b].x+a.matrix[3][1]*c[b].y+a.matrix[3][2]*c[b].z+a.matrix[3][3]*c[b].w;return this},scale:function(a){for(var b=new n,d=0;d<this.length;d++)b.push(a*this[d]);return b},toString:function(){for(var a="",b=0;b<this.length;b++)a+=this[b]+",";return a}}),q=enchant.Class.create(enchant.EventTarget,{initialize:function(a,b,d){enchant.EventTarget.call(this);this.dv=1==arguments.length?
a:0==arguments.length?new h(0,0,0):new h(a,b,d);this.up=new h(0,1,0);this.r=new h(1,0,0);this.u=new h(0,1,0);this.f=new h(0,0,1);this.rotMat=new p;this.movMat=new p;this.rm=new p},rotateY:function(a){this.rm.rotateY(a);this.r=this.rm.apply(this.r);this.u=this.rm.apply(this.u);this.f=this.rm.apply(this.f)},moveR:function(a){this.dv.x+=a*this.r.x;this.dv.y+=a*this.r.y;this.dv.z+=a*this.r.z},moveU:function(a){this.dv.x+=a*this.u.x;this.dv.y+=a*this.u.y;this.dv.z+=a*this.u.z},moveF:function(a){this.dv.x+=
a*this.f.x;this.dv.y+=a*this.f.y;this.dv.z+=a*this.f.z},movePosition:function(a,b,d){1==arguments.length?(this.dv.x+=a.x,this.dv.y+=a.y,this.dv.z+=a.z):(this.dv.x+=a,this.dv.y+=b,this.dv.z+=d)},setPosition:function(a,b,d){1==arguments.length?(this.dv.x=a.x,this.dv.y=a.y,this.dv.z=a.z):(this.dv.x=a,this.dv.y=b,this.dv.z=d)},setAttitude:function(a,b,d){this.r.x=a.x;this.r.y=a.y;this.r.z=a.z;this.u.x=b.x;this.u.y=b.y;this.u.z=b.z;this.f.x=d.x;this.f.y=d.y;this.f.z=d.z},updateMat:function(){this.movMat.initialize();
this.movMat.matrix[0][3]=this.dv.x;this.movMat.matrix[1][3]=this.dv.y;this.movMat.matrix[2][3]=this.dv.z;this.rotMat.initialize();this.rotMat.matrix[0][0]=this.r.x;this.rotMat.matrix[0][1]=this.u.x;this.rotMat.matrix[0][2]=this.f.x;this.rotMat.matrix[1][0]=this.r.y;this.rotMat.matrix[1][1]=this.u.y;this.rotMat.matrix[1][2]=this.f.y;this.rotMat.matrix[2][0]=this.r.z;this.rotMat.matrix[2][1]=this.u.z;this.rotMat.matrix[2][2]=this.f.z},toString:function(){return"dv: "+this.dv.toString()+", f: "+this.f.toString()}});
enchant.Class.create(q,{initialize:function(a,b,d){q.call(this,a,b,d);this.color="#000000";this.sphereR=0;this.sphereOrigin=new h;this.vt=new n;this.rvt=new n;this.updateMat()},setVT:function(a){this.vt=new n(a);this.rvt=new n(a)},draw:function(a,b,d){var e=this.rvt;this.updateMat();this.rm=this.movMat.composition(this.rotMat);this.rm.compositionMe(b);this.rm.compositionMe(d);e.applyFast(this.vt,this.rm);a.beginPath();a.strokeStyle=this.color;a.lineWidth=1;0<=e[0].w&&a.moveTo(Math.round(e[0].x/e[0].w),
Math.round(e[0].y/e[0].w));b=1;for(d=e.length;b<d;b++)0<=e[b].w&&a.lineTo(Math.round(e[b].x/e[b].w),Math.round(e[b].y/e[b].w));a.stroke()},shapeSphereHit:function(a){var b=this.dv,d=this.sphereOrigin,e=new h(b.x+d.x,b.y+d.y,b.z+d.z),b=a.dv,d=a.sphereOrigin,b=new h(b.x+d.x,b.y+d.y,b.z+d.z);e.sub(b);return e.distance()<=a.sphereR+this.sphereR?!0:!1}});enchant.Class.create(q,{initialize:function(a,b,d){q.call(this,a,b,d);this.sphereR=0;this.sphereOrigin=new h;this.front=new h(0,0,-1);this.cv=new h;this.updateMat()},
updateMat:function(){this.front=this.f.copy();this.front.scale(-1);this.cv.x=this.dv.dotProduct(this.r);this.cv.y=this.dv.dotProduct(this.u);this.cv.z=this.dv.dotProduct(this.front);this.rotMat.matrix[0][3]=-this.cv.x;this.rotMat.matrix[1][3]=-this.cv.y;this.rotMat.matrix[2][3]=-this.cv.z;this.rotMat.matrix[0][0]=this.r.x;this.rotMat.matrix[0][1]=this.r.y;this.rotMat.matrix[0][2]=this.r.z;this.rotMat.matrix[1][0]=this.u.x;this.rotMat.matrix[1][1]=this.u.y;this.rotMat.matrix[1][2]=this.u.z;this.rotMat.matrix[2][0]=
this.front.x;this.rotMat.matrix[2][1]=this.front.y;this.rotMat.matrix[2][2]=this.front.z}});return{createRectangleSurface:a,createRectangleSprite:function(a,b,d,e){var f=new Sprite(a,b);f.image=createSimpleSurface(a,b,d,e);return f},createCircleSurface:b,createCircleSprite:function(a,d,e){var f=new Sprite(2*a,2*a);f.image=b(a,d,e);return f},createEllipseSurface:d,createEllipseSprite:function(a,b,e,f){var g=new Sprite(a,b);g.image=d(a,b,e,f);return g},Point:e,Line:f,Area:g,Rectangle:j,Circle:m,Ellipse:k,
Arc:l}}();return{trace:function(){if(0!=arguments.length){var a=Array.prototype.slice.call(arguments,0),b;for(b in a)console.log(a[b])}},makeSpace:function(a){var b="&nbsp;";if(a)for(var d=1;d<a;d++)b+="&nbsp;";return b},playSound:function(a){enchant.Game.instance.assets[a].clone().play()},RepeatSoundPlayer:u,AverageRandamizer:v,Event_SceneExStarting:"Event_SceneExStarting",Event_SceneExInput:s,SceneEx:w,addFadeOutText:function(a,b,d,e){void 0!=MutableText&&(b=new MutableText(b.x,b.y),b.text=d.toString(),
b.fedingValue=1/(enchant.Game.instance.fps*(e||1)),b.addEventListener(enchant.Event.ENTER_FRAME,function(){this.opacity-=this.fedingValue;this.opacity<this.fedingValue&&this.parentNode.removeChild(this)}),a.addChild(b))},keyBind:function(a,b){var d=enchant.Game.instance;d.keybind(a[0].toUpperCase().charCodeAt(0),b);d.keybind(a[0].toLowerCase().charCodeAt(0),b)},toRGBString:function(){if(0==arguments.length)throw Error("toRGBString: invalid arguments.");var a,b,d,e=1;3<=arguments.length?(a=arguments[0],
b=arguments[1],d=arguments[2],4<=arguments.length&&(e=arguments[3])):(a=b=d=arguments[0],2<=arguments.length&&(e=arguments[1]));return"rgba("+a+","+b+","+d+","+e+")"},shuffleArray:function(a){for(var b=[];0<a.length;){var d=Math.floor(Math.random()*a.length);b.push(a.splice(d,1)[0])}return b},Event_TimerTimeOut:"Event_TimerTimeout",Timer:x,toKanji1:function(a){return r(a,"\u3007\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d","\u5341\u767e\u5343\u4e07")},toKanji2:function(a){return r(a,"\u96f6\u58f1\u5f10\u53c2\u8086\u4f0d\u9678\u6f06\u634c\u7396",
"\u62fe\u4f70\u9621\u842c")},degToRad:function(a){return a*Math.PI/180},radToDeg:function(a){return 180*a/Math.PI},makeValues:o,Geolocation:y,collision2Sprites:function(a,b){if(0==a.rotation&&0==b.rotation)return a.intersect(b);var d=Array(9),e=Array(9);d[0]={X:a.x,Y:a.y};d[1]={X:a.x+a.width,Y:a.y};d[2]={X:a.x+a.width,Y:a.y+a.height};d[3]={X:a.x,Y:a.y+a.height};d[4]={X:a.x,Y:a.y};d[5]={X:a.x+a.width/2,Y:a.y};d[6]={X:a.x+a.width/2,Y:a.y+a.height};d[7]={X:a.x,Y:a.y+a.height/2};d[8]={X:a.x+a.width,Y:a.y+
a.height/2};e[0]={X:b.x,Y:b.y};e[1]={X:b.x+b.width,Y:b.y};e[2]={X:b.x+b.width,Y:b.y+b.height};e[3]={X:b.x,Y:b.y+b.height};e[4]={X:b.x,Y:b.y};e[5]={X:b.x+b.width/2,Y:b.y};e[6]={X:b.x+b.width/2,Y:b.y+b.height};e[7]={X:b.x,Y:b.y+b.height/2};e[8]={X:b.x+b.width,Y:b.y+b.height/2};for(var f in d)d[f].X-=a.x+a.width/2,d[f].Y-=a.y+a.height/2;for(f in e)e[f].X-=b.x+b.width/2,e[f].Y-=b.y+b.height/2;for(f in d){var g=d[f].X,j=d[f].Y;d[f].X=g*Math.cos(a.rotation*Math.PI/180)-j*Math.sin(a.rotation*Math.PI/180);
d[f].Y=g*Math.sin(a.rotation*Math.PI/180)+j*Math.cos(a.rotation*Math.PI/180)}for(f in e)g=e[f].X,j=e[f].Y,e[f].X=g*Math.cos(b.rotation*Math.PI/180)-j*Math.sin(b.rotation*Math.PI/180),e[f].Y=g*Math.sin(b.rotation*Math.PI/180)+j*Math.cos(b.rotation*Math.PI/180);for(f in d)d[f].X+=a.x+a.width/2,d[f].Y+=a.y+a.height/2;for(f in e)e[f].X+=b.x+b.width/2,e[f].Y+=b.y+b.height/2;for(f=0;f<d.length-1;f++)for(g=0;g<e.length-1;g++){var j=(e[g+1].X-e[g].X)*(d[f].Y-e[g].Y)-(e[g+1].Y-e[g].Y)*(d[f].X-e[g].X),m=(e[g+
1].X-e[g].X)*(d[f+1].Y-e[g].Y)-(e[g+1].Y-e[g].Y)*(d[f+1].X-e[g].X);if(0>((d[f+1].X-d[f].X)*(e[g].Y-d[f].Y)-(d[f+1].Y-d[f].Y)*(e[g].X-d[f].X))*((d[f+1].X-d[f].X)*(e[g+1].Y-d[f].Y)-(d[f+1].Y-d[f].Y)*(e[g+1].X-d[f].X))&&0>j*m)return!0}return!1},createMaze:t,setMazeData:function(a,b,d,e,f,g){for(var j=[],m=[],g=t(b,d,g),k=0;k<b;k++){j.push([]);m.push([]);for(var l=0;l<d;l++)j[k].push(e),m[k].push(g[k][l]?f:-1)}a.loadData(j,m);a.collisionData=g},stringWidth:function(a,b){return a.context.measureText(b).width},
toKatakanaCase:function(a){for(var b="",d=0;d<a.length;d++)var e=a.charCodeAt(d),b=b+String.fromCharCode(12353<=e&&12438>=e?e+96:e);return b},toHirakanaCase:function(a){for(var b="",d=0;d<a.length;d++)var e=a.charCodeAt(d),b=b+String.fromCharCode(12449<=e&&12534>=e?e-96:e);return b},randomString:function(a){for(var b="",d=0;d<a;d++)b+="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz".charAt(Math.floor(49*Math.random()));return b},isOutOfScreen:function(a){var b=enchant.Game.instance;return 0>a.x+
a.width||0>a.y+a.height||b.width<a.x||b.height<a.y},round:function(a,b){if("number"==typeof b){var d=Math.pow(10,b);return Math.round(a*d)/d}return Math.round(a)},ceil:function(a,b){if("number"==typeof b){var d=Math.pow(10,b);return Math.ceil(a*d)/d}return Math.ceil(a)},floor:function(a,b){if("number"==typeof b){var d=Math.pow(10,b);return Math.floor(a*d)/d}return Math.floor(a)},paddingLeft:function(a,b,d){d=d||"0";a=a.toString();for(b-=a.length;0<b--;)a=d+a;return a},paddingRight:function(a,b,d){d=
d||"0";a=a.toString();for(b-=a.length;0<b--;)a+=d;return a},formatString:function(a,b){var d=void 0;if("object"==typeof b)d=function(a,d){return b[d]};else var e=arguments,d=function(a,b){return e[parseInt(b)+1]};return a.replace(/\{(\w+)\}/g,d)},arrayQueryIf:function(a,b){return a.filter(b)},arrayEraseIf:function(a,b){for(var d=a.length-1;0<=d;d--)b(a[d],d,a)&&a.splice(d,1)},samePartsForEach:function(a,b,d,e,f){function g(b,d){for(var g in l){var c=l[g];if(c.row==b&&c.column==d)return}g=a[b][d];
(g=f?f(k,g):k==g)&&e(b,d);l.push({row:b,column:d,valid:g})}var j=a.length,m=a[0].length,k=a[b][d],l=[];for(g(b,d);;){var b=null,h;for(h in l)if(l[h].valid){b=l[h];break}if(null==b)break;b.valid=!1;0<b.row&&g(b.row-1,b.column);0<b.column&&g(b.row,b.column-1);b.row+1<j&&g(b.row+1,b.column);b.column+1<m&&g(b.row,b.column+1)}},Figure:z}}();