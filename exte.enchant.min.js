var __extends=this.__extends||function(f,r){function y(){this.constructor=f}y.prototype=r.prototype;f.prototype=new y},exte;
(function(f){function r(a){return 1>=a?0:Math.floor(Math.random()*a)}function y(a,b){var c=a;if(b)for(var d=1;d<b;d++)c+=a;return c}function v(a){return 0>a?v(a+2*Math.PI):2*Math.PI<=a?v(a-2*Math.PI):a}function x(a,b){for(var c=[],d=0;d<b;d++)c.push(a);return c}function I(a,b,c,d,e,h){var b=b||1,c=c||"icon0.png",d=d||16,e=e||16,h=h||16,f=a%h*d,a=Math.floor(a/h)*e,h=new enchant.Surface(d*b,e);h.draw(enchant.Game.instance.assets[c],f,a,d*b,e,0,0,d*b,e);return h}function k(a,b,c,d,e,h,f,g,n,s,j,k,l){for(var h=
h||e,f=f||e,g=g||e,n=n||e,s=s||e,j=j||e,k=k||e,l=l||e,m=[],p=0;p<c;p++){var i;0==p?(i=x(f,d),i[0]=h,i[d-1]=g):p+1<c?(i=x(e,d),i[0]=n,i[d-1]=s):(i=x(k,d),i[0]=j,i[d-1]=l);m.push(i)}b=new enchant.Map(b,b);b.image=enchant.Game.instance.assets[a];b.loadData(m);return b}function B(a,b,c,d){var e=new enchant.Surface(a,b),h=e.context;d?(h.fillStyle=c,h.fillRect(0,0,a,b)):(h.strokeStyle=c,h.strokeRect(0,0,a,b));return e}function C(a,b,c){var d=new enchant.Surface(2*a,2*a),e=d.context,h=e.lineWidth;c?e.fillStyle=
b:e.strokeStyle=b;e.beginPath();e.arc(a,a,a-h,0,2*Math.PI,!0);c?e.fill():e.stroke();return d}function D(a,b,c,d){var e=new enchant.Surface(a,b),h=e.context;d?h.fillStyle=c:h.strokeStyle=c;var c=a/2,f=b/2,g=h.lineWidth;h.beginPath();var n=4*(Math.sqrt(2)-1)*c/3,s=4*(Math.sqrt(2)-1)*f/3;h.moveTo(c,g);h.bezierCurveTo(c+n,g,a-g,f-s,a-g,f);h.bezierCurveTo(a-g,f+s,c+n,b-g,c,b-g);h.bezierCurveTo(c-n,b-g,g,f+s,g,f);h.bezierCurveTo(g,f-s,c-n,g,c,g);d?h.fill():h.stroke();return e}function E(a,b,c,d,e){var h=
new enchant.Surface(2*a,2*a),f=h.context,g=f.lineWidth,n=b-0.5*c,b=b+0.5*c;e?f.fillStyle=d:f.strokeStyle=d;f.beginPath();f.moveTo(a,a);f.arc(a,a,a-g,n,b,!1);f.lineTo(a,a);e?f.fill():f.stroke();return h}f.rand=r;f.getUserAgent=function(){var a=navigator.userAgent;return 0<a.indexOf("iPhone")&&-1==a.indexOf("iPad")||0<a.indexOf("iPod")?"iOS":0<a.indexOf("Android")?"Android":0<a.indexOf("Chrome")?"Chrome":0<a.indexOf("Firefox")?"Firefox":0<a.indexOf("Opera")?"Opera":"Other"};f.trace=function(){for(var a=
[],b=0;b<arguments.length-0;b++)a[b]=arguments[b+0];if(0!=a.length){a=Array.prototype.slice.call(a,0);for(b=0;b<a.length;b++)console.log(a[b])}};f.makeRepeatString=y;f.makeSpace=function(a){return y("&nbsp;",a)};var g=function(a){this._table=[];this.range=a};Object.defineProperty(g.prototype,"next",{get:function(){var a=[];this._table.forEach(function(b,c){0==r(b)&&a.push(c)});var b;b=0<a.length?a[r(a.length)]:r(this.range);this._table[b]+=this.range;for(var c=0;c<this.range;c++)this._table[c]--;
return b},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"range",{get:function(){return this._table.length},set:function(a){a<this.range&&(this._table.length=0);for(var b=this.range;b<a;b++)this._table.push(a)},enumerable:!0,configurable:!0});f.AverageRandamizer=g;f.toRGBString=function(){for(var a=[],b=0;b<arguments.length-0;b++)a[b]=arguments[b+0];var c,d;3<=a.length?(b=a[0],c=a[1],d=a[2],a=4<=a.length?a[3]:1):1<=a.length?(b=c=d=a[0],a=2<=a.length?a[1]:1):b=c=d=a=0;return"rgba("+
b+","+c+","+d+","+a+")"};f.shuffleArray=function(a){for(var b=[];0<a.length;){var c=r(a.length),c=a.splice(c,1)[0];b.push(c)}return b};f.makeKanji=function(a,b,c){a=Math.floor(a);if(0==a)return b[0];for(var d=c.length,e=[];0<a;){e.push(a%10);if(c.length+1<e.length){e.length=c.length;for(a=0;a<c.length;a++)e[a]=9;break}a=Math.floor(a/10)}for(a="";0<e.length;){var h=e.pop(),f="";0<e.length&&(f=c[e.length-1]);if(0!=h&&(1!=h||e.length==d||0==e.length))a+=b[h];0<h&&(a+=f)}return a};f.degToRad=function(a){return a*
Math.PI/180};f.radToDeg=function(a){return 180*a/Math.PI};f.normalinzeRad=v;f.normalinzeDeg=function(a){return 0>a?this.normalinzeDeg(a+360):360<=a?this.normalinzeDeg(a-360):a};f.angleToDirection=function(a){a=v(a);return a<0.25*Math.PI?2:a<0.75*Math.PI?0:a<1.25*Math.PI?1:a<1.75*Math.PI?3:2};f.directionToAngle=function(a){switch(a){case 0:return 0.5*Math.PI;case 1:return 1*Math.PI;case 2:return 0*Math.PI;case 3:return 1.5*Math.PI}};f.getNarrowAngle=function(a,b){var a=v(a),b=v(b),c=Math.min(a,b),
d=Math.max(a,b),e=d-c;Math.PI<e&&(e=c+2*Math.PI-d);return e};f.getDistance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)};f.getAngle=function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)};f.makeValues=x;f.createMaze=function(a,b,c){if(0==a%2||0==b%2)throw Error("arguments error");var d=[];d.length=a;if(c)for(var e=0;e<a;e++)0==e||e==a-1?d[e]=x(1,b):(d[e]=x(0,b),d[e][0]=d[e][b-1]=1);else for(e=0;e<a;e++)d[e]=x(0,b);var h=e=1;c&&(e++,h++,a--,b--);for(var c=4,f=[1,0,-1,0],g=[0,1,0,-1];e<
a;e+=2){for(var n=h;n<b;n+=2){d[e][n]=1;var s=r(c);d[e+g[s]][n+f[s]]=1}4==c&&(c=3)}return d};f.randomString=function(a,b){b||(b="ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");for(var c="",a=a||1,d=0;d<a;d++)c+=b.charAt(r(b.length));return c};f.round=function(a,b){if(b){var c=Math.pow(10,b);return Math.round(a*c)/c}return Math.round(a)};f.ceil=function(a,b){if(b){var c=Math.pow(10,b);return Math.ceil(a*c)/c}return Math.ceil(a)};f.floor=function(a,b){if(b){var c=Math.pow(10,b);return Math.floor(a*
c)/c}return Math.floor(a)};f.paddingLeft=function(a,b,c){c=c||"0";a=a.toString();for(b-=a.length;0<b--;)a=c+a;return a};f.paddingRight=function(a,b,c){c=c||"0";a=a.toString();for(b-=a.length;0<b--;)a+=c;return a};f.formatString=function(a){for(var b=[],c=0;c<arguments.length-1;c++)b[c]=arguments[c+1];c=void 0;c=1==b.length&&"object"==typeof b[0]?function(a,c){return b[0][c]}:function(a,c){return b[parseInt(c)+1]};return a.replace(/\{(\w+)\}/g,c)};f.arrayEraseIf=function(a,b){for(var c=a.length-1;0<=
c;c--)b(a[c],c,a)&&a.splice(c,1)};var z;z=function(a,b){this.row=a;this.column=b};f.MapPoint=z;var A,J=z,g=function(a,b,c,d){J.call(this,a,b);this.valid=!0;this.row=a;this.column=b;this.rest=c;this.routes=d};__extends(g,J);A=g;f.ResultRoute=A;var F;F=function(){};f.ResultMoveCost=F;g=function(a){this.map=a;this.rowNum=a.length;this.columnNum=a[0].length;this.limitLeft=0;this.limitRight=this.columnNum-1;this.limitTop=0;this.limitBottom=this.rowNum-1};g.prototype.getSamePoints=function(a,b,c){function d(a,
b,d){f.some(function(a){return a.row==b&&a.column==d})||((a=c(e,a[b][d]))&&h.push(new z(b,d)),f.push({row:b,column:d,valid:a}))}var e=this.map[a][b];void 0===c&&(c=function(a,b){return a==b});var h=[],f=[];for(d(this.map,a,b);;){a=null;for(b=0;b<f.length;b++)if(f[b].valid){a=f[b];break}if(null==a)break;a.valid=!1;this.limitTop<a.row&&d(this.map,a.row-1,a.column);this.limitLeft<a.column&&d(this.map,a.row,a.column-1);a.row+1<this.limitBottom&&d(this.map,a.row+1,a.column);a.column+1<this.limitRight&&
d(this.map,a.row,a.column+1)}return h};g.prototype.getRoute=function(a,b,c){function d(a,b,c,d,f){a=a[b][c];if(!(d<a)){for(var d=d-a,a=[],g=0;g<f.length;g++)a.push(f[g].concat([new z(b,c)]));f=e.filter(function(a){return a.row==b&&a.column==c});if(0<f.length){var i=f[0];i.rest<d?(i.rest=d,i.routes=a,i.valid=!0):i.rest==d&&(a.forEach(function(a){return i.routes.push(a)}),i.valid=!0)}else e.push(new A(b,c,d,a))}}var a=new A(a,b,c,[[]]),e=[];e.push(a);for(a=!0;;){b=null;for(c=0;c<e.length;c++)if(e[c].valid){b=
e[c];break}if(null==b)break;b.valid=!1;this.limitTop<b.row&&d(this.map,b.row-1,b.column,b.rest,b.routes);this.limitLeft<b.column&&d(this.map,b.row,b.column-1,b.rest,b.routes);b.row+1<this.limitBottom&&d(this.map,b.row+1,b.column,b.rest,b.routes);b.column+1<this.limitRight&&d(this.map,b.row,b.column+1,b.rest,b.routes);a&&(a=!1,b.rest=-1)}for(c=e.length-1;0<=c;c--)b=e[c],0>b.rest&&e.splice(c,1);return e};g.prototype.calcMoveCost=function(a,b,c,d,e){var f=0;if(c!=e){for(var g=Math.min(c,e),i=Math.max(c,
e),g=g+1;g<i;g++)f+=a[b][g];f+=a[b][e]}if(b!=d){g=Math.min(b,d);i=Math.max(b,d);for(g+=1;g<i;g++)f+=a[g][e];f+=a[d][e]}var n=this.getRoute(b,c,f),j;n.forEach(function(a){a.row==d&&a.column==e&&(j=n)});for(b=f=0;b<j[0].length;b++)c=j[0][b],f+=a[c.row][c.column];a=new F;a.cost=f;a.routes=j;return a};f.MapPointSeacher=g;f.createIconSurface=I;f.createIconSprite=function(a,b,c,d,e,f){var b=b||1,c=c||"icon0.png",d=d||16,e=e||16,g=new enchant.Sprite(d,e);1==b?(g.image=enchant.Game.instance.assets[c],g.frame=
a):(g.image=I(a,b,c,d,e,f),g.frame=0);return g};f.isDebug=function(){return enchant.Game.instance._debug};f.playSound=function(a){enchant.Game.instance.assets[a].clone().play()};var K=enchant.Node,g=function(a,b,c){K.call(this);this._sound=enchant.Sound.load(a);this._fadeSec=b||5;this._volume=c||1;this.addEventListener(enchant.Event.ENTER_FRAME,this.enterFrame)};__extends(g,K);g.prototype.play=function(){this._sound.volume=this._volume;this._sound.play()};g.prototype.pause=function(){this._sound.pause()};
g.prototype.stop=function(){this._sound.stop()};g.prototype.enterFrame=function(){this._fadeSec<this._sound.duration-this._sound.currentTime||(this._sound.volume=this._volume*(this._sound.duration-this._sound.currentTime)/this._fadeSec,0.01>this._sound.volume&&(this._sound.currentTime=0,this.play()))};f.RepeatSoundPlayer=g;f.Event_SceneInput="exte.enchant.Event_SceneInput";var L=enchant.Event,G=function(a){L.call(this,a)};__extends(G,L);f.SceneExEvent=G;var H;H=function(){this.frame=this.index=0;
this.active=!1};f.InputPatternData=H;var M=enchant.Scene,w=function(){M.call(this);this.inputPatterns=[];this.addEventListener(enchant.Event.ENTER_FRAME,this.enterFrame);[enchant.Event.LEFT_BUTTON_DOWN,enchant.Event.LEFT_BUTTON_UP,enchant.Event.RIGHT_BUTTON_DOWN,enchant.Event.RIGHT_BUTTON_UP,enchant.Event.UP_BUTTON_DOWN,enchant.Event.UP_BUTTON_UP,enchant.Event.DOWN_BUTTON_DOWN,enchant.Event.DOWN_BUTTON_UP,enchant.Event.A_BUTTON_DOWN,enchant.Event.A_BUTTON_UP,enchant.Event.B_BUTTON_DOWN,enchant.Event.B_BUTTON_UP].forEach(function(a){this.addEventListener(a,
this.changeInput)},this)};__extends(w,M);w.prototype.makeEvent=function(a){var b=new G(f.Event_SceneInput);b.eventID=a.eventID;b.sec=a.frame/enchant.Game.instance.fps;enchant.Game.instance.currentScene.dispatchEvent(b)};w.prototype.enterFrame=function(){this.inputPatterns.forEach(function(a){a.active&&a.frame++})};w.prototype.changeInput=function(a){for(var b=0;b<this.inputPatterns.length;b++){var c=this.inputPatterns[b];c.pattern[c.index]!=a.type?(c.index=0,c.frame=0,c.active=!1):c.index+1<c.pattern.length?
(c.index++,c.active=!0):c.loop?(c.active=!0,c.frame<c.framelimit||(this.makeEvent(c),c.frame=0)):(c.frame<=c.framelimit&&this.makeEvent(c),c.index=0,c.frame=0,c.active=!1)}};w.prototype.regist=function(a,b,c,d){var e=new H;e.eventID=a;e.pattern=b;e.framelimit=Math.floor((c||1)*enchant.Game.instance.fps);e.loop=!0===d;this.inputPatterns.push(e)};f.SceneInput=w;f.Event_SceneExStarting="Event_SceneExStarting";var i=function(a,b,c){w.call(this);this._opacity=1;this._setFadeOut=this._setFadeIn=!1;this._nextSceneName=
"";this.name=a;i._scenes[a]=this;a=enchant.Game.instance.fps;b=void 0==b?0.5:b;0<b&&(this._fadeInStep=1/(b*a),this.addEventListener(f.Event_SceneExStarting,function(){this._setFadeIn=!0;this.opacity=0}));b=void 0==c?0.5:c;this._fadeOutStep=0==b?1:1/(b*a);this.addEventListener(enchant.Event.ENTER_FRAME,this.enterFrame)};__extends(i,w);i._scenes=[];i.prototype.enterFrame=function(){this._setFadeIn&&this._fadeIn()&&(this._setFadeIn=!1);this._setFadeOut&&this._fadeOut()&&(this._setFadeOut=!1,this.sceneNext())};
i.prototype.sceneNext=function(){var a=i._scenes[this._nextSceneName];a.dispatchEvent(new enchant.Event(f.Event_SceneExStarting));a===this?a.dispatchEvent(new enchant.Event(enchant.Event.ENTER)):enchant.Game.instance.replaceScene(a)};i.prototype._fadeIn=function(){if(1-this._fadeInStep<=this.opacity)return this.opacity=1,!0;this.opacity+=this._fadeInStep;return!1};i.prototype._fadeOut=function(){if(this.opacity<=this._fadeOutStep)return this.opacity=0,!0;this.opacity-=this._fadeOutStep;return!1};
i.prototype._setOpacityChilds=function(a,b){if(void 0!==a.childNodes)for(var c=0;c<a.childNodes.length;c++){var d=a.childNodes[c];void 0!==d.opacity&&(d.opacity=b);this._setOpacityChilds(d,b)}};Object.defineProperty(i.prototype,"fadeProsessing",{get:function(){return this._setFadeIn||this._setFadeOut},enumerable:!0,configurable:!0});Object.defineProperty(i.prototype,"opacity",{get:function(){return this._opacity},set:function(a){this._opacity=a;this._setOpacityChilds(this,a)},enumerable:!0,configurable:!0});
i.prototype.moveSceneTo=function(a){this._nextSceneName=a;this._setFadeOut=!0};f.SceneEx=i;f.addFadeOutText=function(a,b,c,d){void 0!==enchant.util.MutableText&&(b=new enchant.util.MutableText(b.x,b.y),b.text=c,b.fedingValue=1/(enchant.Game.instance.fps*(d||1)),b.addEventListener(enchant.Event.ENTER_FRAME,function(){this.opacity-=this.fedingValue;this.opacity<this.fedingValue&&this.parentNode.removeChild(this)}),a.addChild(b))};f.keyBind=function(a,b){var c=enchant.Game.instance;c.keybind(a[0].toUpperCase().charCodeAt(0),
b);c.keybind(a[0].toLowerCase().charCodeAt(0),b)};f.Event_TimerTimeOut="Event_TimerTimeout";var N=enchant.Node,g=function(){N.call(this);this._startFrame=this._frame=0;this._active=!1;this._startFrame=this._frame=0;this._active=!1;this.addEventListener(enchant.Event.ENTER_FRAME,function(){this._active&&(this._frame--,0<this._frame||(enchant.Game.instance.currentScene.dispatchEvent(new enchant.Event(f.Event_TimerTimeOut)),this._frame=this._startFrame))})};__extends(g,N);g.prototype.start=function(a){"number"==
typeof a&&(this._frame=this._startFrame=a*enchant.Game.instance.fps);this._active=0<this._startFrame};g.prototype.stop=function(){this._active=!1};f.Timer=g;f.inputToRad=function(){var a=enchant.Game.instance.input;return a.down&&a.right?0.25*Math.PI:a.down&&a.left?0.75*Math.PI:a.up&&a.left?1.25*Math.PI:a.up&&a.right?1.75*Math.PI:a.right?0:a.down?0.5*Math.PI:a.up?1.5*Math.PI:a.left?Math.PI:Number.NaN};f.collision2Sprites=function(a,b){if(0==a.rotation&&0==b.rotation)return a.intersect(b);var c=Array(9),
d=Array(9);c[0]={X:a.x,Y:a.y};c[1]={X:a.x+a.width,Y:a.y};c[2]={X:a.x+a.width,Y:a.y+a.height};c[3]={X:a.x,Y:a.y+a.height};c[4]={X:a.x,Y:a.y};c[5]={X:a.x+a.width/2,Y:a.y};c[6]={X:a.x+a.width/2,Y:a.y+a.height};c[7]={X:a.x,Y:a.y+a.height/2};c[8]={X:a.x+a.width,Y:a.y+a.height/2};d[0]={X:b.x,Y:b.y};d[1]={X:b.x+b.width,Y:b.y};d[2]={X:b.x+b.width,Y:b.y+b.height};d[3]={X:b.x,Y:b.y+b.height};d[4]={X:b.x,Y:b.y};d[5]={X:b.x+b.width/2,Y:b.y};d[6]={X:b.x+b.width/2,Y:b.y+b.height};d[7]={X:b.x,Y:b.y+b.height/2};
d[8]={X:b.x+b.width,Y:b.y+b.height/2};for(var e=0;e<c.length;e++)c[e].X-=a.x+a.width/2,c[e].Y-=a.y+a.height/2;for(e=0;e<d.length;e++)d[e].X-=b.x+b.width/2,d[e].Y-=b.y+b.height/2;for(e=0;e<c.length;e++){var f=c[e].X,g=c[e].Y;c[e].X=f*Math.cos(a.rotation*Math.PI/180)-g*Math.sin(a.rotation*Math.PI/180);c[e].Y=f*Math.sin(a.rotation*Math.PI/180)+g*Math.cos(a.rotation*Math.PI/180)}for(e=0;e<d.length;e++)f=d[e].X,g=d[e].Y,d[e].X=f*Math.cos(b.rotation*Math.PI/180)-g*Math.sin(b.rotation*Math.PI/180),d[e].Y=
f*Math.sin(b.rotation*Math.PI/180)+g*Math.cos(b.rotation*Math.PI/180);for(e=0;e<c.length;e++)c[e].X+=a.x+a.width/2,c[e].Y+=a.y+a.height/2;for(e=0;e<d.length;e++)d[e].X+=b.x+b.width/2,d[e].Y+=b.y+b.height/2;for(e=0;e<c.length-1;e++)for(f=0;f<d.length-1;f++){var g=(d[f+1].X-d[f].X)*(c[e].Y-d[f].Y)-(d[f+1].Y-d[f].Y)*(c[e].X-d[f].X),i=(d[f+1].X-d[f].X)*(c[e+1].Y-d[f].Y)-(d[f+1].Y-d[f].Y)*(c[e+1].X-d[f].X);if(0>((c[e+1].X-c[e].X)*(d[f].Y-c[e].Y)-(c[e+1].Y-c[e].Y)*(d[f].X-c[e].X))*((c[e+1].X-c[e].X)*(d[f+
1].Y-c[e].Y)-(c[e+1].Y-c[e].Y)*(d[f+1].X-c[e].X))&&0>g*i)return!0}return!1};f.setMazeData=function(a,b,c,d,e){for(var f=[],g=[],i=a.collisionData,j=0;j<b;j++){f.push([]);g.push([]);for(var k=0;k<c;k++)f[j].push(d),g[j].push(i[j][k]?e:-1)}a.loadData(f,g)};f.stringWidth=function(a,b){return a.context.measureText(b).width};f.isOutOfScreen=function(a,b){var c=enchant.Game.instance,b=b|0;return a.x+a.width<b||a.y+a.height<b||c.width-b<a.x||c.height-b<a.y};f.createSimpleMap=k;f.createSampleMap=function(a,
b,c){switch(a){case 0:return k("map1.gif",16,b,c,33);case 1:return k("map1.gif",16,b,c,36);case 2:return k("map1.gif",16,b,c,6);case 3:return k("map1.gif",16,b,c,7);case 4:return k("map1.gif",16,b,c,97);case 5:return k("map1.gif",16,b,c,100);case 6:return k("map1.gif",16,b,c,161);case 7:return k("map1.gif",16,b,c,164);case 8:return k("map1.gif",16,b,c,225);case 9:return k("map1.gif",16,b,c,228);case 10:return k("map1.gif",16,b,c,33,16,17,18,32,34,48,49,50);case 11:return k("map1.gif",16,b,c,100,83,
84,85,99,101,115,116,117);case 12:return k("map1.gif",16,b,c,161,144,145,146,160,162,176,177,178);case 13:return k("map1.gif",16,b,c,164,147,148,149,163,165,179,180,181);case 14:return k("map1.gif",16,b,c,228,211,212,213,227,229,243,244,245)}return k("map1.gif",16,b,c,0)};var O=enchant.Group,g=function(a,b,c,d){O.call(this);this.fadeOut=this.fadeIn=0.1;this.scrollPx=2;this.lineHeight=10;this.textAlign=this.wordBreak=this.fontSize=this.font=this.color=null;this.stackLimit=0;this._labels=[];this._texts=
[];this._currentWork=0;this._fadeOutLabel=this._fadeInLabel=null;this._scrollNum=0;this._outAllLog=!1;this._visible=!0;this.x=a;this.y=b;this.width=c;this.height=d;this.addEventListener(enchant.Event.ENTER_FRAME,this.enterFrame)};__extends(g,O);g.prototype.createLabel=function(){var a=new enchant.Label("");a.width=this.width;a.visible=!1;this.font&&(a.font=this.font);this.addChild(a);this._labels.push(a);return a};g.prototype.enterFrame0=function(){if(0!=this._texts.length){this._outAllLog=this._outAllLog?
0<this._texts.length:0<this.stackLimit&&this.stackLimit<=this._texts.length;for(var a=this._texts.shift(),b=null,c=0;c<this._labels.length;c++)if(!this._labels[c].valid){b=this._labels[c];break}b||(b=this.createLabel(),this.wordBreak&&(b._style.wordBreak=this.wordBreak),b.valid=!1);b.x=0;b.y=0;b.text=a.text;b._style.fontSize=a.fontSize||"";b.color=a.color||"";b.height=a.lineHeight||10;b.opacity=0;b.textAlign=a.textAlign||"left";this._fadeInLabel=b;this._scrollNum=b.height;for(c=a=0;c<this._labels.length;c++){var d=
this._labels[c];if(d.valid){var e=d.y+d.height;a<e&&(a=e,this._fadeOutLabel=d)}}this._currentWork=this.height<a+b.height?1:2}};g.prototype.enterFrame1=function(){this._outAllLog||this._fadeOutLabel.opacity<this.fadeOut?(this._fadeOutLabel.opacity=0,this._fadeOutLabel.visible=!1,this._fadeOutLabel.valid=!1,this._currentWork=2):this._fadeOutLabel.opacity-=this.fadeOut};g.prototype.enterFrame2=function(){if(0<this._scrollNum){for(var a=this._outAllLog||this._scrollNum<=this.scrollPx?this._scrollNum:
this.scrollPx,b=0;b<this._labels.length;b++){var c=this._labels[b];c.visible&&(c.y+=a)}this._scrollNum-=a}0>=this._scrollNum&&(this._currentWork=3,this._fadeInLabel.visible=!0,this._fadeInLabel.valid=!0)};g.prototype.enterFrame3=function(){this._outAllLog||1-this.fadeIn<this._fadeInLabel.opacity?(this._fadeInLabel.opacity=1,this._currentWork=0):this._fadeInLabel.opacity+=this.fadeIn};g.prototype.enterFrame=function(){switch(this._currentWork){case 0:this.enterFrame0();break;case 1:this.enterFrame1();
break;case 2:this.enterFrame2();break;case 3:this.enterFrame3()}};Object.defineProperty(g.prototype,"visible",{get:function(){return this._visible},enumerable:!0,configurable:!0});g.prototype.set=function(a){if(this._visible!=a){this._visible=a;for(var b=0;b<this._labels.length;b++){var c=this._labels[b];c.visible=a&&c.valid}}};g.prototype.regist=function(a,b,c,d,e){this._texts.push({text:a,color:b||this.color,fontSize:c||this.fontSize,lineHeight:d||this.lineHeight,textAlign:e||this.textAlign})};
g.prototype.outAllLog=function(){this._outAllLog=!0};g.prototype.clear=function(){for(var a=this._texts.length=0;a<this._labels.length;a++){var b=this._labels[a];b.visible=b.valid=!1}this._currentWork=0};f.LogList=g;f.createRectangleSurface=B;f.createRectangleSprite=function(a,b,c,d){var e=new enchant.Sprite(a,b);e.image=B(a,b,c,d);return e};f.createCircleSurface=C;f.createCircleSprite=function(a,b,c){var d=new enchant.Sprite(2*a,2*a);d.image=C(a,b,c);return d};f.createEllipseSurface=D;f.createEllipseSprite=
function(a,b,c,d){var e=new enchant.Sprite(a,b);e.image=D(a,b,c,d);return e};f.createArcSurface=E;f.createArcSprite=function(a,b,c,d,e){var f=new enchant.Sprite(2*a,2*a);f.image=E(a,b,c,d,e);return f};var q=function(a,b){this.y=this.x=0;this.x=a||0;this.y=b||0};q.prototype.getDistance=function(a){var b=a.x-this.x,a=a.y-this.y;return Math.sqrt(b*b+a*a)};q.prototype.isEqual=function(a){return a.x==this.x&&a.y==this.y};q.prototype.clone=function(){return new q(this.x,this.y)};f.Point=q;var t=function(a,
b,c,d){this.posS=new q(a,b);this.posE=new q(c,d)};Object.defineProperty(t.prototype,"dx",{get:function(){return this.posE.x-this.posS.x},set:function(a){this.posE.x=this.posS.x+a},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"dy",{get:function(){return this.posE.y-this.posS.y},set:function(a){this.posE.y=this.posS.y+a},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"length",{get:function(){return this.posS.getDistance(this.posE)},set:function(a){var b=this.length;
this.posE.x=this.posS.x+Math.floor(this.dx*a/b);this.posE.y=this.posS.y+Math.floor(this.dy*a/b)},enumerable:!0,configurable:!0});t.prototype.isCross=function(a){var b=-this.dy,c=this.dx,d=this.length;0<d&&(d=1/d);var b=b*d,c=c*d,e=a.dx,d=a.dy,f=b*e+c*d;if(0==f)return!1;b=-(b*a.posS.x+c*a.posS.y+-(this.posS.x*b+this.posS.y*c))/f;if(0>=b||1<b)return!1;c=a.posS.x+e*b;a=a.posS.y+d*b;return 0>(this.posS.x-c)*(this.posE.x-c)+(this.posS.y-a)*(this.posE.y-a)};t.prototype.createSurface=function(a,b){var c,
d,e;this.posS.x<this.posE.x==this.posS.y<this.posE.y?(c=0,d=Math.abs(this.dx),e=Math.abs(this.dy)):(c=Math.abs(this.dy),d=Math.abs(this.dx),e=0);var f=new enchant.Surface(Math.abs(this.dx),Math.abs(this.dy)),g=f.context;g.strokeStyle=a;g.lineWidth=b||1;g.beginPath();g.moveTo(0,c);g.lineTo(d,e);g.stroke();return f};t.prototype.createSprite=function(a,b){var c=this.createSurface(a,b),d=new enchant.Sprite(c.width,c.height);d.x=Math.min(this.posS.x,this.posE.x);d.y=Math.min(this.posS.y,this.posE.y);d.image=
c;return d};t.prototype.clone=function(){return new t(this.posS.x,this.posS.y,this.posE.x,this.posE.y)};f.Line=t;var j=function(a,b,c,d){this.x=a||0;this.y=b||0;this.width=c||0;this.height=d||0};Object.defineProperty(j.prototype,"top",{get:function(){return this.y},set:function(a){this.y=a},enumerable:!0,configurable:!0});Object.defineProperty(j.prototype,"bottom",{get:function(){return this.y+this.height},set:function(a){this.height=Math.abs(a-this.y);a<this.y&&(this.y=a)},enumerable:!0,configurable:!0});
Object.defineProperty(j.prototype,"left",{get:function(){return this.x},set:function(a){this.x=a},enumerable:!0,configurable:!0});Object.defineProperty(j.prototype,"right",{get:function(){return this.x+this.width},set:function(a){this.width=Math.abs(a-this.x);a<this.x&&(this.x=a)},enumerable:!0,configurable:!0});Object.defineProperty(j.prototype,"center",{get:function(){return new q(this.x+this.width/2,this.y+this.height/2)},set:function(a){this.x=a.x-this.width/2;this.y=a.y-this.height/2},enumerable:!0,
configurable:!0});Object.defineProperty(j.prototype,"diagonal",{get:function(){return Math.sqrt(this.width*this.width+this.height*this.height)},set:function(a){var b=this.diagonal;0==b?(a*=Math.sqrt(2),this.x-=Math.floor(0.5*a),this.y-=Math.floor(0.5*a),this.width=this.height=Math.floor(a)):this.scale(a/b)},enumerable:!0,configurable:!0});j.prototype.scale=function(a,b){"number"!=typeof b&&(b=a);var c=this.width*a,d=this.height*b;this.x+=Math.floor(0.5*(this.width-c));this.y+=Math.floor(0.5*(this.height-
d));this.width=Math.floor(c);this.height=Math.floor(d)};j.prototype.updateFrom=function(a){this.x=a.x;this.y=a.y;this.height=a.height*a.scaleX;this.width=a.width};j.prototype.setTo=function(a,b){a.x=this.x;a.y=this.y;b?(a.scaleX=a.scaleY=1,a.height=this.height,a.width=this.width):(a.scaleX=this.width/a.width,a.scaleY=this.height/a.height)};j.prototype.getPixels=function(a){var a=a.context.getImageData(this.left,this.top,this.width,this.height).data,b=[];b.length=this.height;for(var c=0;c<this.height;c++){b[c]=
[];b[c].length=this.width;for(var d=0;d<this.width;d++){var e=4*(c*this.width+d);b[c][d]={r:a[e],g:a[e+1],b:a[e+2],a:a[e+3]}}}return b};j.prototype.clone=function(){return new j(this.x,this.y,this.width,this.height)};f.Area=j;var l=function(a,b,c,d){j.call(this,a,b,c,d)};__extends(l,j);l.prototype._calcWidth=function(a){return Math.floor(0.5*this.width*((a-1)%3))};l.prototype._calcHeight=function(a){return Math.floor(0.5*this.height*(2-Math.floor((a-1)/3)))};l.prototype.hitTest=function(a){return this.x<
a.x&&a.x<this.right&&this.y<a.y&&a.y<this.bottom};l.prototype.intersectRect=function(a){return this.x<a.right&&a.x<this.right&&this.y<a.bottom&&a.y<this.bottom};l.prototype.intersectLine=function(a){return this.hitTest(a.posS)||this.hitTest(a.posE)?!0:this.getSideLine(0).isCross(a)||this.getSideLine(1).isCross(a)||this.getSideLine(2).isCross(a)||this.getSideLine(3).isCross(a)};l.prototype.getPos=function(a){return new q(this.x+this._calcWidth(a),this.y+this._calcHeight(a))};l.prototype.setPos=function(a,
b){this.x=b.x-this._calcWidth(a);this.y=b.y-this._calcHeight(a)};l.prototype.adjustPos=function(a){a.x<this.left?a.x=this.left:this.right<a.x&&(a.x=this.right);a.y<this.top?a.y=this.top:this.bottom<a.y&&(a.y=this.bottom)};l.prototype.getRandomPos=function(){return new q(this.x+r(this.width),this.y+r(this.height))};l.prototype.getSideLine=function(a){var b,c;switch(a){case 0:b=7;c=9;break;case 1:b=1;c=3;break;case 2:b=7;c=1;break;case 3:b=9,c=3}a=new t(0,0,0,0);a.posS=this.getPos(b);a.posE=this.getPos(c);
return a};l.prototype.getDiagonalLine=function(a){var b;switch(a){case 1:b=9;break;case 3:b=7;break;case 7:b=3;break;case 9:b=1}var c=new t(0,0,0,0);c.posS=this.getPos(a);c.posE=this.getPos(b);return c};l.prototype.createSurface=function(a,b){return B(this.width,this.height,a,b)};l.prototype.createSprite=function(a,b){var c=this.createSurface(a,b),d=new enchant.Sprite(c.width,c.height);d.image=c;d.x=this.x;d.y=this.y;return d};l.prototype.clone=function(){return new l(this.x,this.y,this.width,this.height)};
f.Rectangle=l;var m=function(a,b,c){j.call(this,a-c,b-c,2*c,2*c)};__extends(m,j);Object.defineProperty(m.prototype,"radius",{get:function(){return this.width/2},set:function(a){var b=Math.floor(0.5*(a-this.radius));this.x-=b;this.y-=b;this.width=2*a},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"diameter",{get:function(){return this.width},enumerable:!0,configurable:!0});m.prototype.set=function(a){var b=Math.floor(0.5*(a-this.diameter));this.x-=b;this.y-=b;this.width=a};m.prototype.hitTest=
function(a){return this.center.getDistance(a)<this.radius};m.prototype.intersectRect=function(){throw Error("Circle.intersectRect is not implemented");};m.prototype.intersectLine=function(){throw Error("Circle.intersectLine is not implemented");};m.prototype.intersectCircle=function(a){var b=(this.diameter+a.diameter)/2,c;return(c=this.x-a.x+(this.width-a.width)/2)*c+(c=this.y-a.y+(this.height-a.height)/2)*c<b*b};m.prototype.adjustPos=function(a){var b=this.center.getDistance(a);if(!(b<this.radius)){var c=
this.center;a.x=c.x+Math.floor(this.radius*(a.x-c.x)/b);a.y=c.y+Math.floor(this.radius*(a.y-c.y)/b)}};m.prototype.getRandomPos=function(){var a=Math.random()*this.radius,b=2*Math.random()*Math.PI,c=this.center;c.x+=Math.floor(Math.cos(b)*a);c.y+=Math.floor(Math.sin(b)*a);return c};m.prototype.createSurface=function(a,b){return C(this.radius,a,b)};m.prototype.createSprite=function(a,b){var c=this.createSurface(a,b),d=new enchant.Sprite(c.width,c.height);d.image=c;d.x=this.x;d.y=this.y;return d};m.prototype.clone=
function(){var a=this.center;return new m(a.x,a.y,this.radius)};f.Circle=m;var u=function(a,b,c,d){j.call(this,a-c/2,b-d/2,c,d)};__extends(u,j);u.prototype.hitTest=function(){throw Error("Ellipse.hitTest is not implemented");};u.prototype.intersectRect=function(){throw Error("Ellipse.intersectRect is not implemented");};u.prototype.intersectLine=function(){throw Error("Ellipse.intersectLine is not implemented");};u.prototype.adjustPos=function(){throw Error("Ellipse.adjustPos is not implemented");
};u.prototype.getRandomPos=function(){throw Error("Ellipse.getRandomPos is not implemented");};u.prototype.createSurface=function(a,b){return D(this.width,this.height,a,b)};u.prototype.createSprite=function(a,b){var c=this.createSurface(a,b),d=new enchant.Sprite(c.width,c.height);d.image=c;d.x=this.x;d.y=this.y;return d};u.prototype.clone=function(){var a=this.center;return new u(a.x,a.y,this.width,this.height)};f.Ellipse=u;var p=function(a,b,c,d,e){m.call(this,a,b,c);this.angle=v(d|0);this.range=
v(e|0)};__extends(p,m);Object.defineProperty(p.prototype,"angleStart",{get:function(){return v(this.angle-0.5*this.range)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"angleEnd",{get:function(){return v(this.angle+0.5*this.range)},enumerable:!0,configurable:!0});p.prototype.hitTest=function(){throw Error("Arc.hitTest is not implemented");};p.prototype.intersectRect=function(){throw Error("Arc.intersectRect is not implemented");};p.prototype.intersectLine=function(){throw Error("Arc.intersectLine is not implemented");
};p.prototype.intersectCircle=function(){throw Error("Arc.intersectCircle is not implemented");};p.prototype.adjustPos=function(){throw Error("Arc.adjustPos is not implemented");};p.prototype.getRandomPos=function(){var a=Math.random()*this.radius,b=this.angle+Math.random()*this.range-0.5*this.range,c=this.center;c.x+=Math.floor(Math.cos(b)*a);c.y+=Math.floor(Math.sin(b)*a);return c};p.prototype.createSurface=function(a,b){return E(this.radius,this.angle,this.range,a,b)};p.prototype.createSprite=
function(a,b){var c=this.createSurface(a,b),d=new enchant.Sprite(c.width,c.height);d.image=c;d.x=this.x;d.y=this.y;return d};p.prototype.clone=function(){var a=this.center;return new p(a.x,a.y,this.radius,this.angle,this.range)};f.Arc=p;var P=enchant.Sprite,g=function(a,b){P.call(this,a,b);this._active=!1;this._radiusLimit=this._radiusMax=this._radius=0;this._speed=1;this.image=new enchant.Surface(a,b);this.addEventListener(enchant.Event.ENTER_FRAME,function(){this._active&&(this._radius+=this._speed,
this._radius<this._radiusMax?this._draw():this.stop())})};__extends(g,P);g.prototype._draw=function(){var a=this.image.context;a.fillStyle="transparent";this.image.clear();a.beginPath();a.arc(this._center.x,this._center.y,this._radius,0,2*Math.PI,!1);a.closePath();a.stroke()};Object.defineProperty(g.prototype,"lineColor",{get:function(){return this.image.context.strokeStyle},enumerable:!0,configurable:!0});g.prototype.set=function(a){this.image.context.strokeStyle=a};Object.defineProperty(g.prototype,
"lineWidth",{get:function(){return this.image.context.lineWidth},set:function(a){this.image.context.lineWidth=a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"speed",{get:function(){return this._speed},set:function(a){this._speed=a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"radius",{get:function(){return this._radius},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"radiusMax",{get:function(){return this._radiusMax},enumerable:!0,configurable:!0});
Object.defineProperty(g.prototype,"radiusLimit",{get:function(){return this._radiusLimit},set:function(a){this._radiusLimit=a},enumerable:!0,configurable:!0});g.prototype.start=function(a,b){this._center=new q(a,b);this._active=!0;this._radius=0;this._radiusMax=0<this._radiusLimit?this._radiusLimit:this._center.getDistance(new q(this.width/2<a?0:this.width,this.height/2<b?0:this.height));this.image.clear()};Object.defineProperty(g.prototype,"active",{get:function(){return this._active},set:function(a){this._active!=
a&&!(a&&0==this._radiusMax)&&(this._active=a)},enumerable:!0,configurable:!0});g.prototype.stop=function(){this._active=!1;this._radiusMax=0;this.image.clear()};f.Ripple=g})(exte||(exte={}));